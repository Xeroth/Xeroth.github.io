<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Live with love]]></title>
  <subtitle><![CDATA[Live with love]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://yoursite.com/"/>
  <updated>2016-04-22T09:20:08.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name><![CDATA[践行]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[Centos 7 安装Docker]]></title>
    <link href="http://yoursite.com/2016/04/22/Centos-7-%E5%AE%89%E8%A3%85Docker/"/>
    <id>http://yoursite.com/2016/04/22/Centos-7-安装Docker/</id>
    <published>2016-04-22T06:31:15.000Z</published>
    <updated>2016-04-22T09:20:08.000Z</updated>
    <content type="html"><![CDATA[<p>环境:阿里云 centos7 镜像</p>
<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h3><p>1.查看内核版本, 如果内核太旧, 请升级到最新版本</p>
<pre><code># uname -r
3.10.0-327.13.1.el7.x86_64

# yum update -y
</code></pre><p>2.官方脚本安装</p>
<pre><code># curl -fsSL https://get.docker.com/ | sh
+ sh -c &apos;sleep 3; yum -y -q install docker-engine&apos;
warning: /var/cache/yum/x86_64/7/docker-main-repo/packages/docker-engine-selinux-1.11.0-1.el7.centos.noarch.rpm: Header V4 RSA/SHA512 Signature, key ID 2c52609d: NOKEY
Public key for docker-engine-selinux-1.11.0-1.el7.centos.noarch.rpm is not installed
https://yum.dockerproject.org/repo/main/centos/7/Packages/docker-engine-1.11.0-1.el7.centos.x86_64.rpm: [Errno 12] Timeout on https://yum.dockerproject.org/repo/main/centos/7/Packages/docker-engine-1.11.0-1.el7.centos.x86_64.rpm: (28, &apos;Operation timed out after 3000 milliseconds with 0 out of 0 bytes received&apos;)
Trying other mirror.
https://yum.dockerproject.org/repo/main/centos/7/Packages/docker-engine-1.11.0-1.el7.centos.x86_64.rpm: [Errno 12] Timeout on https://yum.dockerproject.org/repo/main/centos/7/Packages/docker-engine-1.11.0-1.el7.centos.x86_64.rpm: (28, &apos;Operation timed out after 3001 milliseconds with 0 out of 0 bytes received&apos;)
Trying other mirror.
Importing GPG key 0x2C52609D:
 Userid     : &quot;Docker Release Tool (releasedocker) &lt;docker@docker.com&gt;&quot;
 Fingerprint: 5811 8e89 f3a9 1289 7c07 0adb f762 2157 2c52 609d
 From       : https://yum.dockerproject.org/gpg
setsebool:  SELinux is disabled.

If you would like to use Docker as a non-root user, you should now consider
adding your user to the &quot;docker&quot; group with something like:

  sudo usermod -aG docker your-user

Remember that you will have to log out and back in for this to take effect!
</code></pre><p>3.启动</p>
<pre><code>service docker start
</code></pre><p>4.测试</p>
<pre><code># docker run hello-world
Unable to find image &apos;hello-world:latest&apos; locally
latest: Pulling from library/hello-world
03f4658f8b78: Pull complete
a3ed95caeb02: Pull complete
Digest: sha256:8be990ef2aeb16dbcb9271ddfe2610fa6658d13f6dfb8bc72074cc1ca36966a7
Status: Downloaded newer image for hello-world:latest

Hello from Docker.
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker Hub account:
 https://hub.docker.com

For more examples and ideas, visit:
 https://docs.docker.com/userguide/
</code></pre><p>5.设置开机启动</p>
<pre><code># chkconfig docker on
Note: Forwarding request to &apos;systemctl enable docker.service&apos;.
Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
</code></pre><h3 id="u5378_u8F7D"><a href="#u5378_u8F7D" class="headerlink" title="卸载"></a>卸载</h3><pre><code>yum list installed | grep docker
docker-engine.x86_64               1.11.0-1.el7.centos        @docker-main-repo
docker-engine-selinux.noarch       1.11.0-1.el7.centos        @docker-main-repo

yum -y remove docker-engine.x86_64

rm -rf /var/lib/docker
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<p>环境:阿里云 centos7 镜像</p>
<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h3><p>1.查看内核版本, 如果内核太旧, 请升级到最新版本<]]>
    </summary>
    
      <category term="Docker" scheme="http://yoursite.com/tags/Docker/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Ansible synchronize]]></title>
    <link href="http://yoursite.com/2016/04/20/Ansible-synchronize/"/>
    <id>http://yoursite.com/2016/04/20/Ansible-synchronize/</id>
    <published>2016-04-20T12:00:58.000Z</published>
    <updated>2016-04-22T03:53:38.000Z</updated>
    <content type="html"><![CDATA[<p>注意几个参数,[default: no]或者有特殊配置的:</p>
<ul>
<li>copy_links    拷贝软连接的真实文件, 而不是软连接</li>
<li>delete    在进行同步后是否删除 src 中不存在的文件, 默认情况下, 是会保留 dest 目标文件夹原先就存在的文件</li>
<li>existing_only    ?</li>
<li>mode      [ default: push ]本地或者委托到目标机</li>
</ul>
<a id="more"></a>
<h3 id="ansible-doc"><a href="#ansible-doc" class="headerlink" title="ansible-doc"></a>ansible-doc</h3><figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line">&gt; SYNCHRONIZE</span><br><span class="line"></span><br><span class="line">  This <span class="keyword">is</span> a wrapper around rsync. <span class="keyword">Of</span> course you could just use the</span><br><span class="line">  command action <span class="keyword">to</span> <span class="keyword">call</span> rsync yourself, but you also have <span class="keyword">to</span> add a</span><br><span class="line">  fair number <span class="keyword">of</span> boilerplate options <span class="keyword">and</span> host facts. You still may</span><br><span class="line">  need <span class="keyword">to</span> <span class="keyword">call</span> rsync directly via `command<span class="comment">' or `shell' depending on</span></span><br><span class="line">  your use <span class="keyword">case</span>. The synchronize action <span class="keyword">is</span> meant <span class="keyword">to</span> <span class="keyword">do</span> common things</span><br><span class="line">  <span class="keyword">with</span> `rsync<span class="comment">' easily. It does not provide access to the full power of</span></span><br><span class="line">  rsync, but does make most invocations easier <span class="keyword">to</span> follow.</span><br><span class="line"></span><br><span class="line">Options (= <span class="keyword">is</span> mandatory):</span><br><span class="line"></span><br><span class="line">- archive</span><br><span class="line">        Mirrors the rsync archive flag, enables recursive, links,</span><br><span class="line">        perms, times, owner, <span class="keyword">group</span> flags <span class="keyword">and</span> -D. (Choices: yes, no)</span><br><span class="line">        [<span class="keyword">Default</span>: yes]</span><br><span class="line"></span><br><span class="line">- checksum</span><br><span class="line">        <span class="keyword">Skip</span> based <span class="keyword">on</span> checksum, rather than <span class="keyword">mod</span>-time &amp; size; Note that</span><br><span class="line">        that <span class="string">"archive"</span> <span class="keyword">option</span> <span class="keyword">is</span> still enabled <span class="keyword">by</span> <span class="keyword">default</span> - the</span><br><span class="line">        <span class="string">"checksum"</span> <span class="keyword">option</span> will <span class="keyword">not</span> disable it. (Choices: yes, no)</span><br><span class="line">        [<span class="keyword">Default</span>: no]</span><br><span class="line"></span><br><span class="line">- compress</span><br><span class="line">        Compress file data during the transfer. <span class="keyword">In</span> most cases, leave</span><br><span class="line">        this enabled unless it causes problems. (Choices: yes, no)</span><br><span class="line">        [<span class="keyword">Default</span>: yes]</span><br><span class="line"></span><br><span class="line">- copy_links</span><br><span class="line">        Copy symlinks <span class="keyword">as</span> the item that they point <span class="keyword">to</span> (the referent) <span class="keyword">is</span></span><br><span class="line">        copied, rather than the symlink. (Choices: yes, no) [<span class="keyword">Default</span>:</span><br><span class="line">        no]</span><br><span class="line"></span><br><span class="line">- delete</span><br><span class="line">        Delete files that don<span class="comment">'t exist (after transfer, not before) in</span></span><br><span class="line">        the `src<span class="comment">' path. This option requires `recursive=yes'.</span></span><br><span class="line">        (Choices: yes, no) [<span class="keyword">Default</span>: no]</span><br><span class="line"></span><br><span class="line">= dest</span><br><span class="line">        Path <span class="keyword">on</span> the destination machine that will be synchronized <span class="keyword">from</span></span><br><span class="line">        the source; The path can be absolute <span class="keyword">or</span> relative.</span><br><span class="line"></span><br><span class="line">- dest_port</span><br><span class="line">        Port number <span class="keyword">for</span> ssh <span class="keyword">on</span> the destination host. The</span><br><span class="line">        ansible_ssh_port inventory var takes precedence over this</span><br><span class="line">        value. [<span class="keyword">Default</span>: <span class="number">22</span>]</span><br><span class="line"></span><br><span class="line">- dirs</span><br><span class="line">        Transfer directories without recursing (Choices: yes, no)</span><br><span class="line">        [<span class="keyword">Default</span>: no]</span><br><span class="line"></span><br><span class="line">- existing_only</span><br><span class="line">        <span class="keyword">Skip</span> creating <span class="keyword">new</span> files <span class="keyword">on</span> receiver. (Choices: yes, no)</span><br><span class="line">        [<span class="keyword">Default</span>: no]</span><br><span class="line"></span><br><span class="line">- <span class="keyword">group</span></span><br><span class="line">        <span class="keyword">Preserve</span> <span class="keyword">group</span> (Choices: yes, no) [<span class="keyword">Default</span>: the value <span class="keyword">of</span> the</span><br><span class="line">        archive <span class="keyword">option</span>]</span><br><span class="line"></span><br><span class="line">- links</span><br><span class="line">        Copy symlinks <span class="keyword">as</span> symlinks. (Choices: yes, no) [<span class="keyword">Default</span>: the</span><br><span class="line">        value <span class="keyword">of</span> the archive <span class="keyword">option</span>]</span><br><span class="line"></span><br><span class="line">- mode</span><br><span class="line">        Specify the direction <span class="keyword">of</span> the synchronization. <span class="keyword">In</span> push mode the</span><br><span class="line">        localhost <span class="keyword">or</span> <span class="keyword">delegate</span> <span class="keyword">is</span> the source; <span class="keyword">In</span> pull mode the remote</span><br><span class="line">        host <span class="keyword">in</span> context <span class="keyword">is</span> the source. (Choices: push, pull) [<span class="keyword">Default</span>:</span><br><span class="line">        push]</span><br><span class="line"></span><br><span class="line">- owner</span><br><span class="line">        <span class="keyword">Preserve</span> owner (super user only) (Choices: yes, no) [<span class="keyword">Default</span>:</span><br><span class="line">        the value <span class="keyword">of</span> the archive <span class="keyword">option</span>]</span><br><span class="line"></span><br><span class="line">- perms</span><br><span class="line">        <span class="keyword">Preserve</span> permissions. (Choices: yes, no) [<span class="keyword">Default</span>: the value</span><br><span class="line">        <span class="keyword">of</span> the archive <span class="keyword">option</span>]</span><br><span class="line"></span><br><span class="line">- recursive</span><br><span class="line">        Recurse <span class="keyword">into</span> directories. (Choices: yes, no) [<span class="keyword">Default</span>: the</span><br><span class="line">        value <span class="keyword">of</span> the archive <span class="keyword">option</span>]</span><br><span class="line"></span><br><span class="line">- rsync_opts</span><br><span class="line">        Specify additional rsync options <span class="keyword">by</span> passing <span class="keyword">in</span> an array.</span><br><span class="line">        [<span class="keyword">Default</span>: None]</span><br><span class="line"></span><br><span class="line">- rsync_path</span><br><span class="line">        Specify the rsync command <span class="keyword">to</span> run <span class="keyword">on</span> the remote machine. See</span><br><span class="line">        `--rsync-path<span class="comment">' on the rsync man page.</span></span><br><span class="line"></span><br><span class="line">- rsync_timeout</span><br><span class="line">        Specify a --timeout <span class="keyword">for</span> the rsync command <span class="keyword">in</span> seconds.</span><br><span class="line">        [<span class="keyword">Default</span>: <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">- set_remote_user</span><br><span class="line">        put user@ <span class="keyword">for</span> the remote paths. <span class="keyword">If</span> you have a <span class="keyword">custom</span> ssh</span><br><span class="line">        config <span class="keyword">to</span> define the remote user <span class="keyword">for</span> a host that does <span class="keyword">not</span></span><br><span class="line">        match the inventory user, you should <span class="keyword">set</span> this parameter <span class="keyword">to</span></span><br><span class="line">        <span class="string">"no"</span>. [<span class="keyword">Default</span>: <span class="literal">True</span>]</span><br><span class="line"></span><br><span class="line">= src</span><br><span class="line">        Path <span class="keyword">on</span> the source machine that will be synchronized <span class="keyword">to</span> the</span><br><span class="line">        destination; The path can be absolute <span class="keyword">or</span> relative.</span><br><span class="line"></span><br><span class="line">- times</span><br><span class="line">        <span class="keyword">Preserve</span> modification times (Choices: yes, no) [<span class="keyword">Default</span>: the</span><br><span class="line">        value <span class="keyword">of</span> the archive <span class="keyword">option</span>]</span><br><span class="line"></span><br><span class="line">Notes:  rsync must be installed <span class="keyword">on</span> both the local <span class="keyword">and</span> remote machine.</span><br><span class="line">        Inspect the verbose output <span class="keyword">to</span> validate the destination</span><br><span class="line">        user/host/path are what was expected. The remote user <span class="keyword">for</span> the</span><br><span class="line">        dest path will always be the remote_user, <span class="keyword">not</span> the sudo_user.</span><br><span class="line">        Expect that dest=~/x will be ~&lt;remote_user&gt;/x even <span class="keyword">if</span> <span class="keyword">using</span></span><br><span class="line">        sudo. <span class="keyword">To</span> exclude files <span class="keyword">and</span> directories <span class="keyword">from</span> being</span><br><span class="line">        synchronized, you may add `.rsync-filter<span class="comment">' files to the source</span></span><br><span class="line">        directory.</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXAMPLES:</span><br><span class="line"># Synchronization of src on the control machine to dest on the remote hosts</span><br><span class="line">synchronize: src=some/relative/path dest=/some/absolute/path</span><br><span class="line"></span><br><span class="line"># Synchronization without any <span class="comment">--archive options enabled</span></span><br><span class="line">synchronize: src=some/relative/path dest=/some/absolute/path archive=no</span><br><span class="line"></span><br><span class="line"># Synchronization with <span class="comment">--archive options enabled except for --recursive</span></span><br><span class="line">synchronize: src=some/relative/path dest=/some/absolute/path recursive=no</span><br><span class="line"></span><br><span class="line"># Synchronization with <span class="comment">--archive options enabled except for --times, with --checksum option enabled</span></span><br><span class="line">synchronize: src=some/relative/path dest=/some/absolute/path <span class="operator"><span class="keyword">checksum</span>=yes times=<span class="keyword">no</span></span><br><span class="line"></span><br><span class="line"># Synchronization <span class="keyword">without</span> <span class="comment">--archive options enabled except use --links</span></span><br><span class="line">synchronize: src=<span class="keyword">some</span>/<span class="keyword">relative</span>/<span class="keyword">path</span> dest=/<span class="keyword">some</span>/<span class="keyword">absolute</span>/<span class="keyword">path</span> <span class="keyword">archive</span>=<span class="keyword">no</span> links=yes</span><br><span class="line"></span><br><span class="line"># Synchronization <span class="keyword">of</span> two paths <span class="keyword">both</span> <span class="keyword">on</span> the control machine</span><br><span class="line">local_action: synchronize src=<span class="keyword">some</span>/<span class="keyword">relative</span>/<span class="keyword">path</span> dest=/<span class="keyword">some</span>/<span class="keyword">absolute</span>/<span class="keyword">path</span></span><br><span class="line"></span><br><span class="line"># Synchronization <span class="keyword">of</span> src <span class="keyword">on</span> the inventory host <span class="keyword">to</span> the dest <span class="keyword">on</span> the localhost <span class="keyword">in</span></span><br><span class="line">pull <span class="keyword">mode</span></span><br><span class="line">synchronize: <span class="keyword">mode</span>=pull src=<span class="keyword">some</span>/<span class="keyword">relative</span>/<span class="keyword">path</span> dest=/<span class="keyword">some</span>/<span class="keyword">absolute</span>/<span class="keyword">path</span></span><br><span class="line"></span><br><span class="line"># Synchronization <span class="keyword">of</span> src <span class="keyword">on</span> <span class="keyword">delegate</span> host <span class="keyword">to</span> dest <span class="keyword">on</span> the <span class="keyword">current</span> inventory host.</span><br><span class="line"># <span class="keyword">If</span> delegate_to <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">to</span> the <span class="keyword">current</span> inventory host, this can be used <span class="keyword">to</span> syncronize</span><br><span class="line"># two directories <span class="keyword">on</span> that host. </span><br><span class="line">synchronize: &gt;</span><br><span class="line">    src=<span class="keyword">some</span>/<span class="keyword">relative</span>/<span class="keyword">path</span> dest=/<span class="keyword">some</span>/<span class="keyword">absolute</span>/<span class="keyword">path</span></span><br><span class="line">    delegate_to: <span class="keyword">delegate</span>.host</span><br><span class="line"></span><br><span class="line"># Synchronize <span class="keyword">and</span> <span class="keyword">delete</span> files <span class="keyword">in</span> dest <span class="keyword">on</span> the remote host that <span class="keyword">are</span> <span class="keyword">not</span> <span class="keyword">found</span> <span class="keyword">in</span> src <span class="keyword">of</span> localhost.</span><br><span class="line">synchronize: src=<span class="keyword">some</span>/<span class="keyword">relative</span>/<span class="keyword">path</span> dest=/<span class="keyword">some</span>/<span class="keyword">absolute</span>/<span class="keyword">path</span> <span class="keyword">delete</span>=yes</span><br><span class="line"></span><br><span class="line"># Synchronize <span class="keyword">using</span> an alternate rsync command</span><br><span class="line">synchronize: src=<span class="keyword">some</span>/<span class="keyword">relative</span>/<span class="keyword">path</span> dest=/<span class="keyword">some</span>/<span class="keyword">absolute</span>/<span class="keyword">path</span> rsync_path=<span class="string">"sudo rsync"</span></span><br><span class="line"></span><br><span class="line"># Example .rsync-filter <span class="keyword">file</span> <span class="keyword">in</span> the <span class="keyword">source</span> <span class="keyword">directory</span></span><br><span class="line">- <span class="keyword">var</span>       # <span class="keyword">exclude</span> <span class="keyword">any</span> <span class="keyword">path</span> whose <span class="keyword">last</span> part <span class="keyword">is</span> <span class="string">'var'</span></span><br><span class="line">- /<span class="keyword">var</span>      # <span class="keyword">exclude</span> <span class="keyword">any</span> <span class="keyword">path</span> <span class="keyword">starting</span> <span class="keyword">with</span> <span class="string">'var'</span> <span class="keyword">starting</span> <span class="keyword">at</span> the <span class="keyword">source</span> <span class="keyword">directory</span></span><br><span class="line">+ /<span class="keyword">var</span>/conf # <span class="keyword">include</span> /<span class="keyword">var</span>/conf even though it was previously excluded</span><br><span class="line"></span><br><span class="line"># Synchronize <span class="keyword">passing</span> <span class="keyword">in</span> extra rsync options</span><br><span class="line">synchronize: src=/tmp/helloworld dest=/<span class="keyword">var</span>/www/helloword rsync_opts=<span class="comment">--no-motd,--exclude=.git</span></span></span><br></pre></td></tr></table></figure>
<h3 id="u7528_u6765_u505A_u751F_u4EA7_u73AF_u5883_beta__u73AF_u5883_u540C_u6B65"><a href="#u7528_u6765_u505A_u751F_u4EA7_u73AF_u5883_beta__u73AF_u5883_u540C_u6B65" class="headerlink" title="用来做生产环境 beta 环境同步"></a>用来做生产环境 beta 环境同步</h3><p>同步 nginx 主目录下的配置, 除了 vhost 配置目录不同步</p>
<p>一个坑:</p>
<pre><code>synchronize: src=~/Documents/eg/svn/everinner_app_beta/config_app dest=/opt/www
</code></pre><p>这个相当于把<code>config_app</code>目录拷贝到<code>/opt/www</code>下, 拷贝后变成<code>/opt/www/config_app</code>, 如果 写成<code>dest=/opt/www/config_app</code>, 拷贝后会变成<code>/opt/www/config_app/config_app</code></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>注意几个参数,[default: no]或者有特殊配置的:</p>
<ul>
<li>copy_links    拷贝软连接的真实文件, 而不是软连接</li>
<li>delete    在进行同步后是否删除 src 中不存在的文件, 默认情况下, 是会保留 dest 目标文件夹原先就存在的文件</li>
<li>existing_only    ?</li>
<li>mode      [ default: push ]本地或者委托到目标机</li>
</ul>]]>
    
    </summary>
    
      <category term="Ansible" scheme="http://yoursite.com/tags/Ansible/"/>
    
      <category term="Synchronize" scheme="http://yoursite.com/tags/Synchronize/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[系统管理常用脚本]]></title>
    <link href="http://yoursite.com/2016/04/19/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"/>
    <id>http://yoursite.com/2016/04/19/系统管理常用脚本/</id>
    <published>2016-04-19T09:29:28.000Z</published>
    <updated>2016-04-22T03:50:54.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u6587_u4EF6_u548C_u6587_u4EF6_u5939_u6743_u9650_u9012_u5F52_u4E3A777_uFF0C_u8FD8_u539F_u6210_u9ED8_u8BA4_u7684755_u548C644"><a href="#u6587_u4EF6_u548C_u6587_u4EF6_u5939_u6743_u9650_u9012_u5F52_u4E3A777_uFF0C_u8FD8_u539F_u6210_u9ED8_u8BA4_u7684755_u548C644" class="headerlink" title="文件和文件夹权限递归为777，还原成默认的755和644"></a>文件和文件夹权限递归为777，还原成默认的755和644</h3><pre><code>find . -type f -exec chmod 644 {} +
find ./ -type d |xargs chmod 755
</code></pre><h3 id="u8BB2_ssh/config__u7684_u4E3B_u673A_u4FE1_u606F_u8F6C_u79FB_u5230_ansible_hosts__u6587_u4EF6"><a href="#u8BB2_ssh/config__u7684_u4E3B_u673A_u4FE1_u606F_u8F6C_u79FB_u5230_ansible_hosts__u6587_u4EF6" class="headerlink" title="讲 ssh/config 的主机信息转移到 ansible hosts 文件"></a>讲 ssh/config 的主机信息转移到 ansible hosts 文件</h3><pre><code>awk -F[=\ ] &apos;$2 ~ /HD_Server/ {print &quot;[&quot;$2&quot;]&quot;; a=a$2&quot;\n&quot;}; $1 ~ /Hostname/ {print $2} END{print &quot;[HDS]\n&quot;a}&apos; .ssh/config
</code></pre><p>其中<code>a=a$2&quot;\n&quot;</code> 为字符串连接</p>
<h3 id="u521B_u5EFA_swap"><a href="#u521B_u5EFA_swap" class="headerlink" title="创建 swap"></a>创建 swap</h3><pre><code>[root@node1 ~]# cat create_swap.sh
#!/bin/bash

fallocate -l 512M /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo &quot;/swapfile none swap defaults 0 0&quot; &gt;&gt;  /etc/fstab
mount -a
free -m
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u6587_u4EF6_u548C_u6587_u4EF6_u5939_u6743_u9650_u9012_u5F52_u4E3A777_uFF0C_u8FD8_u539F_u6210_u9ED8_u8BA4_u7684755_u548C644"><a href=]]>
    </summary>
    
      <category term="shell" scheme="http://yoursite.com/tags/shell/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Vagrant安装使用]]></title>
    <link href="http://yoursite.com/2016/04/14/Vagrant%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2016/04/14/Vagrant安装使用/</id>
    <published>2016-04-14T10:49:01.000Z</published>
    <updated>2016-04-14T11:29:05.000Z</updated>
    <content type="html"><![CDATA[<p>下载,安装</p>
<p>在新 terminal 可以看到 vagrant 命令</p>
<pre><code>$ vagrant --version
Vagrant 1.8.1
</code></pre><h3 id="u51E0_u4E2A_u6982_u5FF5"><a href="#u51E0_u4E2A_u6982_u5FF5" class="headerlink" title="几个概念"></a>几个概念</h3><p><em>Provider</em>：供应商，在这里指Vagrant调用的虚拟化工具。Vagrant本身并没有能力创建虚拟机，它是调用一些虚拟化工具来创建，如VirtualBox、VMWare、Xen、Docker，甚至AWS，这些虚拟化工具只要安装好了，vagrant会自动封装在底层通过统一的命令调用。也就是说使用vagrant时你电脑上还需要安装对应的Provider，默认是免费开源的virtualbox。<br><em>Box</em>：可被Vagrant直接使用的虚拟机镜像文件，大小根据内容的不同从200M-2G不等。针对不同的Provider，Box文件的格式是不一样的，从 vagrantcloud.com 你可以找到社区维护的box。</p>
<p><em>Vagrantfile</em>：Vagrant根据Vagrantfile中的配置来创建虚拟机，是Vagrant的核心。在Vagrantfile文件中你需要指明使用哪个Box（可以下载好的或自己制作，或指定在线的URL地址），虚拟机使用的内存大小和CPU，需要预安装哪些软件，虚拟机的网络配置，与host的共享目录等。</p>
<p><em>Provisioner</em>：是Vagrant的插件的一种。大部分现成的box并不是你正好想要的，通过使用你熟悉的provisioner，比如Puppet，可以在你使用vagrant up启动虚拟机时自动的安装软件、修改配置等初始化操作。当然你也可以在最先启动虚拟机后，使用vagrant ssh进去然后手动安装软件，但毕竟不是所有人都是系统管理员，写好Vagrantfile后无需人工干预马上就可以使用vm。目前支持并实现的provisioning有Puppet、Salt、Ansible、Chef这些知名的自动化运维工具，当然需要一定的使用经验；也可以使用shell provisioner，故名思议这个插件就是通过执行shell命令完成统一的作用。</p>
<p><em>Guest Additions</em>：这个是常在下载 base box 介绍里有的，一般用来实现host到vm的端口转发、目录共享，在开发环境上都建议装上以便测试。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>下载,安装</p>
<p>在新 terminal 可以看到 vagrant 命令</p>
<pre><code>$ vagrant --version
Vagrant 1.8.1
</code></pre><h3 id="u51E0_u4E2A_u6982_u5FF5"><]]>
    </summary>
    
      <category term="vagrant" scheme="http://yoursite.com/tags/vagrant/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[安装管理Dokuwiki]]></title>
    <link href="http://yoursite.com/2016/04/14/%E5%AE%89%E8%A3%85%E7%AE%A1%E7%90%86Dokuwiki/"/>
    <id>http://yoursite.com/2016/04/14/安装管理Dokuwiki/</id>
    <published>2016-04-14T04:00:33.000Z</published>
    <updated>2016-04-15T01:39:10.000Z</updated>
    <content type="html"><![CDATA[<p>搭建 lnmp 环境</p>
<p>下载解压, 将解压文件配置为nginx虚拟主机根目录</p>
<p>主要讲下安全设置</p>
<p>主要是禁止直接访问</p>
<ul>
<li>data</li>
<li>conf</li>
<li>bin</li>
</ul>
<p>这三个目录</p>
<p>检测方式是看能否访问到</p>
<p><a href="http://yoursite.com/data/pages/wiki/dokuwiki.txt">http://yoursite.com/data/pages/wiki/dokuwiki.txt</a></p>
<a id="more"></a>
<h3 id="u914D_u7F6Enginx_u7981_u6B62_u8BBF_u95EE_u7279_u5B9A_u76EE_u5F55"><a href="#u914D_u7F6Enginx_u7981_u6B62_u8BBF_u95EE_u7279_u5B9A_u76EE_u5F55" class="headerlink" title="配置nginx禁止访问特定目录"></a>配置nginx禁止访问特定目录</h3><p>一开始打算用 nginx 禁止目录访问功能, 在 nginx 配置了:</p>
<pre><code>location ^~ /(data|conf|bin|inc)/* {
        deny all;
}
</code></pre><h3 id="u6539_u53D8_u6570_u636E_u76EE_u5F55_u4F4D_u7F6E"><a href="#u6539_u53D8_u6570_u636E_u76EE_u5F55_u4F4D_u7F6E" class="headerlink" title="改变数据目录位置"></a>改变数据目录位置</h3><p>当然最好是直接把这些目录迁出网站根目录了</p>
<pre><code># 转移conf
[root@HD_Server_Config dokuwiki-2015-08-10a]# mv conf /data/dokuwiki/
# 添加配置
[root@HD_Server_Config dokuwiki-2015-08-10a]# vim inc/preload.php
&lt;?php

define(&apos;DOKU_CONF&apos;,&apos;/data/dokuwiki/conf/&apos;);

# 转移 data
[root@HD_Server_Config dokuwiki-2015-08-10a]# mv data /data/dokuwiki/
# 添加配置
[root@HD_Server_Config dokuwiki-2015-08-10a]# vim /data/dokuwiki/conf/local.php

$conf[&apos;savedir&apos;] = &apos;/data/dokuwiki/data/&apos;;

# 转移 bin
[root@HD_Server_Config dokuwiki-2015-08-10a]# mv bin /data/dokuwiki/
</code></pre><h3 id="u5B89_u88C5_u63D2_u4EF6"><a href="#u5B89_u88C5_u63D2_u4EF6" class="headerlink" title="安装插件"></a>安装插件</h3><p><strong>管理</strong> -&gt; <strong>扩展管理器</strong></p>
<p><strong>搜索和安装</strong>  </p>
<p><em>swiftmail</em> 配置发送 smtp 邮件, 然后在 <strong>管理</strong> -&gt; <strong>配置设置</strong> -&gt; <strong>插件设置</strong>(右侧边栏处)</p>
<p>smtp_host : smtp.exmail.qq.com</p>
<p>smtp_port: 465</p>
<p>smtp_ssl: SSL</p>
<p>auth_user: smtp 邮箱地址, 比如admin@123.com</p>
<p>auth_pass: 邮箱密码</p>
<p>localdomain: yoursite.com</p>
<p>除此之外, 还需要配置<strong>通知设置</strong></p>
<p>通知设置里的东西全部填上勾上</p>
<p>比如邮件地址都填</p>
<p>admin@123.com</p>
<p>邮件前缀填wiki_admin</p>
<p>设置完之后 <strong>管理</strong> 界面下有个 <strong>检查 SwiftMail 配置</strong></p>
<p><em>imgpaste</em> 在编辑器直接粘贴就可以插入剪贴板中的图片，可以用来快速上传截图。</p>
<p><em>Tag</em>    在文档顶部加入标签 </p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line"><span class="expansion">&#123;&#123;tag&gt;it mannual&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p><em>cloud</em>  支持标签云</p>
<p><em>Backup Tool</em> 备份工具</p>
<p><em>addnewpage</em>  新建页面功能太隐晦了… 得在 url 那里添加, 所以搞了个插件</p>
<p><em>pagelist</em>    表格形式列出wiki页面列表</p>
<h3 id="u7F16_u8F91"><a href="#u7F16_u8F91" class="headerlink" title="编辑"></a>编辑</h3><p><a href="https://www.dokuwiki.org/start?id=zh:wiki:syntax" target="_blank" rel="external">格式化语法</a></p>
<h3 id="u5347_u7EA7"><a href="#u5347_u7EA7" class="headerlink" title="升级"></a>升级</h3><p><a href="https://www.dokuwiki.org/zh:install:upgrade" target="_blank" rel="external">升级</a></p>
<h3 id="u6279_u91CF_u7528_u6237_u5BFC_u5165"><a href="#u6279_u91CF_u7528_u6237_u5BFC_u5165" class="headerlink" title="批量用户导入"></a>批量用户导入</h3><p>先是创建了2个用户, 然后导出了用户 csv 文件, 看了一下文件结构:</p>
<pre><code>user1,user1,user1@yoursite.cn,user
user2,user2,user2@yoursite.cn,user
</code></pre><p>然后建立一个文件,里面存放用户名:</p>
<pre><code>user3
user4
...
</code></pre><p>最后用 awk 生成 csv 文件</p>
<pre><code>awk &apos;{printf &quot;%s,%s,%s@yoursite.cn,user\n&quot;, $1,$1,$1}&apos; member.txt &gt; member.csv
</code></pre><p>导入 csv 文件即可</p>
<p>参考:</p>
<p><a href="https://www.dokuwiki.org/zh:security" target="_blank" rel="external">Dokuwikiu安全</a></p>
<p><a href="http://drops.wooyun.org/tips/1323" target="_blank" rel="external">Nginx安全配置研究</a></p>
<p><a href="http://www.jianshu.com/p/a6b00b055fcd" target="_blank" rel="external">DokuWiki简介及插件推荐</a></p>
<p><a href="http://www.ligenyuan.cn/wiki/reproduce:dokuwiki_page_name" target="_blank" rel="external">dokuwiki命名空间</a></p>
<p><a href="http://www.baiguo.net/wiki/doku.php?id=wiki:plugins" target="_blank" rel="external">Doku插件整理</a></p>
<p><a href="http://blog.csdn.net/zouhao619/article/details/8523637" target="_blank" rel="external">更换编辑器–我还没空折腾这个…</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>搭建 lnmp 环境</p>
<p>下载解压, 将解压文件配置为nginx虚拟主机根目录</p>
<p>主要讲下安全设置</p>
<p>主要是禁止直接访问</p>
<ul>
<li>data</li>
<li>conf</li>
<li>bin</li>
</ul>
<p>这三个目录</p>
<p>检测方式是看能否访问到</p>
<p><a href="http://yoursite.com/data/pages/wiki/dokuwiki.txt">http://yoursite.com/data/pages/wiki/dokuwiki.txt</a></p>]]>
    
    </summary>
    
      <category term="Dokuwiki" scheme="http://yoursite.com/tags/Dokuwiki/"/>
    
      <category term="nginx" scheme="http://yoursite.com/tags/nginx/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[MySQL Galera Cluster 学习]]></title>
    <link href="http://yoursite.com/2016/04/13/MySQL-Galera-Cluster-%E5%AD%A6%E4%B9%A0/"/>
    <id>http://yoursite.com/2016/04/13/MySQL-Galera-Cluster-学习/</id>
    <published>2016-04-13T09:07:44.000Z</published>
    <updated>2016-04-20T00:34:45.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://galeracluster.com/documentation-webpages/" target="_blank" rel="external">官网文档</a></p>
<h2 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h2><h3 id="u6709_u4E09_u79CD_u7248_u672C_u53EF_u4EE5_u9009_u62E9_u5B89_u88C5"><a href="#u6709_u4E09_u79CD_u7248_u672C_u53EF_u4EE5_u9009_u62E9_u5B89_u88C5" class="headerlink" title="有三种版本可以选择安装"></a>有三种版本可以选择安装</h3><ul>
<li>mysql 版本</li>
<li>Percona XtraDB Cluster 版本</li>
<li>Mariadb 版本</li>
</ul>
<h3 id="u5B89_u88C5_u9047_u5230_u5F88_u591A_u5751_3A"><a href="#u5B89_u88C5_u9047_u5230_u5F88_u591A_u5751_3A" class="headerlink" title="安装遇到很多坑:"></a>安装遇到很多坑:</h3><p>比如, 安装 mysql 版本的, 更新 yum 源时候, 被墙了:</p>
<pre><code>http://releases.galeracluster.com/centos/6/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 6 - &quot;Couldn&apos;t resolve host &apos;releases.galeracluster.com&apos;&quot;
Trying other mirror.
Error: Cannot retrieve repository metadata (repomd.xml) for repository: galera. Please verify its path and try again
</code></pre><p>比如, 安装 Percona XtraDB Cluster 版本的, 提示仓库没那个软件包…</p>
<pre><code>[root@node2 ~]#  yum install Percona-XtraDB-Cluster -y
Loaded plugins: security
Setting up Install Process
No package Percona-XtraDB-Cluster available.
Error: Nothing to do
</code></pre><p>比如, 装了 PXC 的 yum 仓库包之后, 再装 mariadb, 会产生软件包冲突, md 得格式化系统了 - -</p>
<pre><code>Transaction Check Error:
  file /usr/lib64/libmysqlclient.so.16.0.0 from install of MariaDB-compat-10.0.24-1.el6.x86_64 conflicts with file from package Percona-Server-shared-51-5.1.73-rel14.12.625.rhel6.x86_64
  file /usr/lib64/libmysqlclient_r.so.16.0.0 from install of MariaDB-compat-10.0.24-1.el6.x86_64 conflicts with file from package Percona-Server-shared-51-5.1.73-rel14.12.625.rhel6.x86_64
  file /etc/my.cnf from install of MariaDB-common-10.0.24-1.el6.x86_64 conflicts with file from package Percona-Server-shared-51-5.1.73-rel14.12.625.rhel6.x86_64
</code></pre><a id="more"></a>
<h3 id="u5B89_u88C5Mariadb__u7248_u672C_3A"><a href="#u5B89_u88C5Mariadb__u7248_u672C_3A" class="headerlink" title="安装Mariadb 版本:"></a>安装Mariadb 版本:</h3><h4 id="u660E_u767D_u5B89_u88C5_u7684_u662F_u4EC0_u4E48"><a href="#u660E_u767D_u5B89_u88C5_u7684_u662F_u4EC0_u4E48" class="headerlink" title="明白安装的是什么"></a>明白安装的是什么</h4><p>安装的是数据库命令行客户端, 打了 wsrep API 补丁的数据库服务器, 还有 Galera 集群插件</p>
<blockquote>
<p>There are three packages involved in the installation of MariaDB Galera Cluster: the MariaDB database client, a command line tool for accessing the database; the MariaDB database server, built to include the wsrep API patch; and the Galera Replication Plugin.</p>
</blockquote>
<p>跟普通的数据库包有什么不同?<br>&gt;<br>Binary installation packages for Galera Cluster include the database server with the wsrep API patch. When building from source, you must apply this patch yourself.</p>
<p>了解上面之后, 开始安装. 我用的 centos6.5 ,先把 selinux, 防火墙啥的都关了</p>
<pre><code>[root@node1,2,3 ~]# cat /etc/yum.repos.d/MariaDB.repo
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.0/centos6-amd64
gpgkey = https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck = 1
</code></pre><p>见鬼, 阿里云的 dns 解析居然解析不到 yum.mariadb.org , 将 dns 修改为114的才行</p>
<pre><code>[root@node1,2,3 ~]# yum clean all
[root@node1,2,3 ~]# yum makecache
[root@node1,2,3 ~]# yum install MariaDB-client MariaDB-Galera-server galera -y
</code></pre><p>折腾了一番, 终于装上了</p>
<pre><code>[root@node1,2,3 ~]# mysql --version
mysql  Ver 15.1 Distrib 10.0.24-MariaDB, for Linux (x86_64) using readline 5.1
</code></pre><p><a href="http://galeracluster.com/documentation-webpages/installmariadb.html" target="_blank" rel="external">安装参考</a></p>
<h2 id="u914D_u7F6E"><a href="#u914D_u7F6E" class="headerlink" title="配置"></a>配置</h2><p><del>创建数据库目录</del></p>
<p><del>mkdir -p /data/MariaDB/data</del></p>
<p><del>chown -R mysql:mysql /data/MariaDB/</del></p>
<h3 id="u521D_u59CB_u5316_u914D_u7F6E"><a href="#u521D_u59CB_u5316_u914D_u7F6E" class="headerlink" title="初始化配置"></a>初始化配置</h3><pre><code>[root@node1,2,3 ~]# service mysql start
[root@node1,2,3 ~]# mysql_secure_installation   #生成 root 密码, 别的全选 y
[root@node1,2,3 ~]# chkconfig mysql on
</code></pre><h3 id="u521B_u5EFA"><a href="#u521B_u5EFA" class="headerlink" title="创建"></a>创建</h3><pre><code>集群同步用户
mysql -uroot -p
GRANT ALL PRIVILEGES ON *.* TO &apos;cluster&apos;@&apos;%&apos; IDENTIFIED BY &apos;lookback&apos; WITH GRANT OPTION;
FLUSH PRIVILEGES;
</code></pre><h3 id="u4FEE_u6539_u914D_u7F6E_u6587_u4EF6"><a href="#u4FEE_u6539_u914D_u7F6E_u6587_u4EF6" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>node1</p>
<pre><code>[root@node1 ~]# sed -ne &apos;/\[mariadb-10.0\]/,$p&apos; /etc/my.cnf.d/server.cnf
[mariadb-10.0]

query_cache_size=0
binlog_format=ROW
default_storage_engine=innodb
innodb_autoinc_lock_mode=2
wsrep_provider=/usr/lib64/galera/libgalera_smm.so
###这里需要注意，如果集群是第一次启动请用当前配置，等其他节点启动起来后将下面两行的注释对换重启本节点就OK
wsrep_cluster_address=&quot;gcomm://&quot;
#wsrep_cluster_address=&quot;gcomm://10.45.207.236,10.174.246.101,10.251.174.207&quot;
wsrep_cluster_name=&apos;cluster1&apos;
wsrep_node_address=&apos;10.45.207.236&apos;
wsrep_node_name=&apos;node1&apos;
wsrep_sst_method=rsync
wsrep_sst_auth=cluster:lookback
</code></pre><p>注意<code>wsrep_provider=/usr/lib64/galera/libgalera_smm.so</code> so 文件的真实位置</p>
<p>node2</p>
<pre><code>[root@node2 ~]# sed -ne &apos;/\[mariadb-10.0\]/,//p&apos; /etc/my.cnf.d/server.cnf
[mariadb-10.0]

query_cache_size=0
binlog_format=ROW
default_storage_engine=innodb
innodb_autoinc_lock_mode=2
wsrep_provider=/usr/lib64/galera/libgalera_smm.so
wsrep_cluster_address=&quot;gcomm://10.45.207.236,10.174.246.101,10.251.174.207&quot;
wsrep_cluster_name=&apos;cluster1&apos;
wsrep_node_address=&apos;10.174.246.101&apos;
wsrep_node_name=&apos;node2&apos;
wsrep_sst_method=rsync
wsrep_sst_auth=cluster:lookback
</code></pre><p>node3</p>
<pre><code>[root@node3 ~]# sed -ne &apos;/\[mariadb-10.0\]/,//p&apos; /etc/my.cnf.d/server.cnf
[mariadb-10.0]

query_cache_size=0
binlog_format=ROW
default_storage_engine=innodb
innodb_autoinc_lock_mode=2
wsrep_provider=/usr/lib64/galera/libgalera_smm.so
wsrep_cluster_address=&quot;gcomm://10.45.207.236,10.174.246.101,10.251.174.207&quot;
wsrep_cluster_name=&apos;cluster1&apos;
wsrep_node_address=&apos;10.251.174.207&apos;
wsrep_node_name=&apos;node3&apos;
wsrep_sst_method=rsync
wsrep_sst_auth=cluster:lookback
</code></pre><p>一些共同的参数配置:</p>
<p>[mysqld]下都加上 skip-name-resolve</p>
<h3 id="u8BBE_u7F6Eswap"><a href="#u8BBE_u7F6Eswap" class="headerlink" title="设置swap"></a>设置swap</h3><pre><code>[root@node2 ~]# fallocate -l 512M /swapfile
[root@node2 ~]# chmod 600 /swapfile
[root@node2 ~]# mkswap /swapfile
[root@node2 ~]# swapon /swapfile
[root@node2 ~]# mount -a
[root@node2 ~]# cat /etc/fstab |grep swap
# swapfile
/swapfile none swap defaults 0 0
[root@node2 ~]# swapon --summary
Filename                                Type            Size    Used    Priority
/swapfile                               file            524280  0       -1
</code></pre><h2 id="u542F_u52A8"><a href="#u542F_u52A8" class="headerlink" title="启动"></a>启动</h2><p>先启动 node1的mariadb, 然后启动 node2, node3<br>然后修改 node1配置文件, 对换 gcomm 那里的配置, 重启 node1的mariadb<br>进入各个 node 的数据库, 查看</p>
<pre><code>MariaDB [(none)]&gt; SHOW STATUS LIKE &apos;wsrep%&apos;;

 +---------------------------+------------+
 | Variable_name             | Value      |
 +---------------------------+------------+
 ...
 | wsrep_local_state_comment | Synced (6) |
 | wsrep_cluster_size        | 3          |
 | wsrep_ready               | ON         |
 +---------------------------+------------+
</code></pre><h2 id="u6D4B_u8BD5"><a href="#u6D4B_u8BD5" class="headerlink" title="测试"></a>测试</h2><p>1.节点写入测试,分别在3台 node 上进行写入测试</p>
<pre><code>CREATE DATABASE galeratest;
USE galeratest;
CREATE TABLE test_table (
        id INT PRIMARY KEY AUTO_INCREMENT,
        msg TEXT ) ENGINE=InnoDB;
INSERT INTO test_table (msg)
        VALUES (&quot;Hello my dear cluster.&quot;);
INSERT INTO test_table (msg)
        VALUES (&quot;Hello, again, cluster dear.&quot;);
</code></pre><p>2.脑裂测试</p>
<p>扩展阅读:</p>
<p><a href="http://my.oschina.net/moooofly/blog/92288" target="_blank" rel="external">HA 集群的脑裂问题</a></p>
<p>参考:</p>
<p><a href="http://www.dwhd.org/20150924_133631.html" target="_blank" rel="external">Linux之CentOS 6.7上编译+YUM两种方法配置MariaDB Galera多主集群实现HA</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p><a href="http://galeracluster.com/documentation-webpages/">官网文档</a></p>
<h2 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h2><h3 id="u6709_u4E09_u79CD_u7248_u672C_u53EF_u4EE5_u9009_u62E9_u5B89_u88C5"><a href="#u6709_u4E09_u79CD_u7248_u672C_u53EF_u4EE5_u9009_u62E9_u5B89_u88C5" class="headerlink" title="有三种版本可以选择安装"></a>有三种版本可以选择安装</h3><ul>
<li>mysql 版本</li>
<li>Percona XtraDB Cluster 版本</li>
<li>Mariadb 版本</li>
</ul>
<h3 id="u5B89_u88C5_u9047_u5230_u5F88_u591A_u5751_3A"><a href="#u5B89_u88C5_u9047_u5230_u5F88_u591A_u5751_3A" class="headerlink" title="安装遇到很多坑:"></a>安装遇到很多坑:</h3><p>比如, 安装 mysql 版本的, 更新 yum 源时候, 被墙了:</p>
<pre><code>http://releases.galeracluster.com/centos/6/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 6 - &quot;Couldn&apos;t resolve host &apos;releases.galeracluster.com&apos;&quot;
Trying other mirror.
Error: Cannot retrieve repository metadata (repomd.xml) for repository: galera. Please verify its path and try again
</code></pre><p>比如, 安装 Percona XtraDB Cluster 版本的, 提示仓库没那个软件包…</p>
<pre><code>[root@node2 ~]#  yum install Percona-XtraDB-Cluster -y
Loaded plugins: security
Setting up Install Process
No package Percona-XtraDB-Cluster available.
Error: Nothing to do
</code></pre><p>比如, 装了 PXC 的 yum 仓库包之后, 再装 mariadb, 会产生软件包冲突, md 得格式化系统了 - -</p>
<pre><code>Transaction Check Error:
  file /usr/lib64/libmysqlclient.so.16.0.0 from install of MariaDB-compat-10.0.24-1.el6.x86_64 conflicts with file from package Percona-Server-shared-51-5.1.73-rel14.12.625.rhel6.x86_64
  file /usr/lib64/libmysqlclient_r.so.16.0.0 from install of MariaDB-compat-10.0.24-1.el6.x86_64 conflicts with file from package Percona-Server-shared-51-5.1.73-rel14.12.625.rhel6.x86_64
  file /etc/my.cnf from install of MariaDB-common-10.0.24-1.el6.x86_64 conflicts with file from package Percona-Server-shared-51-5.1.73-rel14.12.625.rhel6.x86_64
</code></pre>]]>
    
    </summary>
    
      <category term="Galera" scheme="http://yoursite.com/tags/Galera/"/>
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[svn仓库间数据转移, 回滚, 子目录权限控制]]></title>
    <link href="http://yoursite.com/2016/04/12/svn%E4%BB%93%E5%BA%93%E9%97%B4%E6%95%B0%E6%8D%AE%E8%BD%AC%E7%A7%BB/"/>
    <id>http://yoursite.com/2016/04/12/svn仓库间数据转移/</id>
    <published>2016-04-12T01:36:17.000Z</published>
    <updated>2016-04-22T09:22:18.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u8D77_u56E0"><a href="#u8D77_u56E0" class="headerlink" title="起因"></a>起因</h3><p>由于之前的同事没有好好规划 svn 仓库结构, 现需要重新规划目录结构如下:</p>
<pre><code>project1
    ├── branches
    ├── tags
    └── trunk
        ├── code
        │   ├── andriod
        │   ├── ios
        │   ├── php
        │   └── sql
        ├── doc
        └── readme.txt
</code></pre><p><strong>trunk</strong>是主分支，是日常开发进行的地方。</p>
<p><strong>branches</strong>是分支。一些阶段性的release版本，这些版本是可以继续进行开发和维护的，则放在branches目录中。又比如为不同用户客制化的版本，也可以放在分支中进行开发。</p>
<p><strong>tags</strong>目录一般是只读的，这里存储阶段性的发布版本，只是作为一个里程碑的版本进行存档。    </p>
<p>现在需要将分散的代码仓库都迁移放到 <em>trunk-code</em> 目录下进行分类存放, 并规划相应仓库的人员权限</p>
<a id="more"></a>
<h3 id="u6743_u9650_u6D4B_u8BD5"><a href="#u6743_u9650_u6D4B_u8BD5" class="headerlink" title="权限测试"></a>权限测试</h3><p>由于迁移得先通知部门成员, 停止提交并暂停 svn 服务, 估计得找个夜黑风高的时候进行, 大白天的我还是先测试一下子目录里仓库的人员权限吧</p>
<p>虽说是权限测试, 我们也得搞点数据过来, 顺便当代码仓库迁移演练吧</p>
<h4 id="u4ED3_u5E93_u95F4_u6570_u636E_u8FC1_u79FB_u65B9_u5F0F_3A"><a href="#u4ED3_u5E93_u95F4_u6570_u636E_u8FC1_u79FB_u65B9_u5F0F_3A" class="headerlink" title="仓库间数据迁移方式:"></a>仓库间数据迁移方式:</h4><p>不能直接将A仓库重命名为B，或将A复制得到一个复本，再将复本命名为B</p>
<p>使用<em>svnadmin dump</em> &amp; <em>svnadmin load</em></p>
<p>创建B仓库(如果B不存在)</p>
<pre><code>svnadmin create /svndata/B    
</code></pre><p>导出A仓库</p>
<pre><code>svnadmin dump /svndata/A &gt; A.dump    
</code></pre><p>将 A仓库 备份文件导入 B 仓库</p>
<pre><code>svnadmin load /svndata/B &lt; A.dump
</code></pre><h4 id="u7136_u800C_u95EE_u9898_u6765_u4E86"><a href="#u7136_u800C_u95EE_u9898_u6765_u4E86" class="headerlink" title="然而问题来了"></a>然而问题来了</h4><p>发现设想的svn目录结构不太好实现, 因为svn 不支持仓库里面创建子仓库, 只能自己创建子目录</p>
<pre><code># svnadmin create project1/trunk
svnadmin: E165002: &apos;/data/svndata/project1/trunk&apos; is a subdirectory of an existing repository rooted at &apos;/data/svndata/project1&apos;
</code></pre><p>如果是通过子目录的方式, 假设ios 目录的代码要回滚, 那岂不是整个代码仓库都要跟着回滚了?</p>
<p>不过也不确定能不能只回滚单个目录, 还得实验测试一下</p>
<p>而且通过 checkout 旧仓库到子目录, 然后再 add/commit 到新仓库的方式, 旧仓库的历史记录不就都丢失了么? 因为不删除 .svn 就无法 add, 会报错的</p>
<pre><code>svn: warning: W150002: &apos;/opt/www/svnhook/project1/trunk/code/php/everouter_app&apos; is already under version control
svn: E200009: Could not add all targets because some targets are already versioned
svn: E200009: Illegal target for the requested operation
</code></pre><p>如果能接受丢失旧库历史版本, 那么测试一下能不能只回滚单个目录(经下方检测, 是可以的)</p>
<h4 id="u597D_u5427_2C__u987A_u4FBF_u6765_u5B66_u4E60_u4E00_u4E0B_svn__u7684_u56DE_u6EDA"><a href="#u597D_u5427_2C__u987A_u4FBF_u6765_u5B66_u4E60_u4E00_u4E0B_svn__u7684_u56DE_u6EDA" class="headerlink" title="好吧, 顺便来学习一下 svn 的回滚"></a>好吧, 顺便来学习一下 svn 的回滚</h4><p>先分别到2个子目录做变更提交</p>
<pre><code>[root@iZ94c5cs7guZ everouter_app]# touch outest
[root@iZ94c5cs7guZ everouter_app]# svn add outest
A         outest
[root@iZ94c5cs7guZ everouter_app]# svn ci -m &quot;add outest&quot;

[root@iZ94c5cs7guZ everinner_app]# touch intest
[root@iZ94c5cs7guZ everinner_app]# svn add intest
A         intest
[root@iZ94c5cs7guZ everinner_app]# svn ci -m &quot;add intest&quot;    
</code></pre><p>还有2个未提交的    </p>
<pre><code>[root@iZ94c5cs7guZ everinner_app]# echo 123 &gt; intest
[root@iZ94c5cs7guZ everinner_app]# svn st
M       intest
[root@iZ94c5cs7guZ everinner_app]# cd ..
[root@iZ94c5cs7guZ php]# cd everouter_app/
[root@iZ94c5cs7guZ everouter_app]# echo 456 &gt; outest
[root@iZ94c5cs7guZ everouter_app]# svn st
M       outest
[root@iZ94c5cs7guZ everouter_app]# cd ..
[root@iZ94c5cs7guZ php]# svn st
M       everinner_app/intest
M       everouter_app/outest
</code></pre><p>现在有2个尚未提交的改动, 试试看能不能只 revert 其中一个</p>
<pre><code>[root@iZ94c5cs7guZ php]# svn revert everinner_app/intest
Reverted &apos;everinner_app/intest&apos;
[root@iZ94c5cs7guZ php]# svn st
M       everouter_app/outest
</code></pre><p>好, 可以睇到, 单独 revert 一个未 commit 的文件系某问题嘅</p>
<p>然后测试对整个目录的回滚, 先进行一些变更</p>
<pre><code>[root@iZ94c5cs7guZ php]# cd everinner_app/
[root@iZ94c5cs7guZ everinner_app]# echo 789 &gt; intest
[root@iZ94c5cs7guZ everinner_app]# cd conf/
[root@iZ94c5cs7guZ conf]# echo 456 &gt; intest2
[root@iZ94c5cs7guZ conf]# svn add intest2
A         intest2
[root@iZ94c5cs7guZ conf]# cd ..
[root@iZ94c5cs7guZ everinner_app]# svn st
M       conf/intest2
M       intest
</code></pre><p>看看发生的变更</p>
<pre><code>[root@iZ94c5cs7guZ everinner_app]# cd ..
[root@iZ94c5cs7guZ php]# svn st
A       everinner_app/conf/intest2
M       everinner_app/intest
M       everouter_app/outest
</code></pre><p>回滚everinner_app目录</p>
<pre><code>[root@iZ94c5cs7guZ php]# svn revert everinner_app/ --recursive
Reverted &apos;everinner_app/conf/intest2&apos;
Reverted &apos;everinner_app/intest&apos;
[root@iZ94c5cs7guZ php]# svn st
M       everouter_app/outest
</code></pre><p>可以看出, 未 commit 的目录也是可以整个回滚的, 但是具体到开发人员使用会是怎样的一种情况呢…</p>
<p>那么已经 commit 的情况下呢?</p>
<p>查看一下提交的历史记录</p>
<pre><code>$ svn update

$ svn log|less

------------------------------------------------------------------------
r5 | hugo | 2016-04-12 16:02:32 +0800 (Tue, 12 Apr 2016) | 1 line

666 outest
------------------------------------------------------------------------
r4 | hugo | 2016-04-12 15:59:55 +0800 (Tue, 12 Apr 2016) | 1 line

add outest change
------------------------------------------------------------------------
r3 | hugo | 2016-04-12 14:20:01 +0800 (Tue, 12 Apr 2016) | 1 line

add outest
------------------------------------------------------------------------
r2 | hugo | 2016-04-12 14:19:25 +0800 (Tue, 12 Apr 2016) | 1 line

add intest
------------------------------------------------------------------------
r1 | hugo | 2016-04-12 11:56:01 +0800 (Tue, 12 Apr 2016) | 1 line

add trunk/code/php/everinner_app and trunk/code/php/everouter_app
------------------------------------------------------------------------
(END)
</code></pre><p>假设我们outest 文件修改错了, 要回滚到r3版本(当前版本是 r5, ), 先对比一下</p>
<pre><code>[root@iZ94c5cs7guZ php]# svn diff -r 5:3 everouter_app/outest
Index: everouter_app/outest
===================================================================
--- everouter_app/outest    (revision 5)
+++ everouter_app/outest    (revision 3)
@@ -1,2 +0,0 @@
-456
-666
</code></pre><p>可以看出 r3版本是没有456,666这两行的,确定无误之后, 用 merge 回滚</p>
<pre><code>[root@iZ94c5cs7guZ php]# svn merge -r 5:3 everouter_app/outest
--- Reverse-merging r5 through r4 into &apos;everouter_app/outest&apos;:
U    everouter_app/outest
--- Recording mergeinfo for reverse merge of r5 through r4 into &apos;everouter_app/outest&apos;:
 U   everouter_app/outest
--- Eliding mergeinfo from &apos;everouter_app/outest&apos;:
 U   everouter_app/outest
[root@iZ94c5cs7guZ php]# cat everouter_app/outest
[root@iZ94c5cs7guZ php]#
</code></pre><p>确认无误后, 提交</p>
<pre><code>[root@iZ94c5cs7guZ php]# svn commit -m &quot;revert to revision 3&quot;
Sending        everouter_app/outest
Transmitting file data .
Committed revision 6.
</code></pre><p>如果 outer 目录和 inner 目录都有变更, 回滚会不会互相影响呢, 用脚趾头想想是会的</p>
<pre><code>[root@iZ94c5cs7guZ php]# svn diff -r 7:4
Index: everinner_app/intest
===================================================================
--- everinner_app/intest    (revision 7)
+++ everinner_app/intest    (revision 4)
@@ -1 +0,0 @@
-123
Index: everouter_app/outest
===================================================================
--- everouter_app/outest    (revision 7)
+++ everouter_app/outest    (revision 4)
@@ -0,0 +1 @@
+456  
</code></pre><p>看上面的对比, 如果我们想要回到版本4,让 intest 去掉123那行, 那么会使得 outest 增加456, 相互影响了</p>
<p>好吧, 子目录的回滚之谜已经解决, 结论就是未 commit 的可以目录内 revert, 子目录间不受影响</p>
<p>已经 commit 的则不能随意 merge 了, 会影响到其他目录内容</p>
<h4 id="u6B63_u5F0F_u5F00_u59CB_u6743_u9650_u6D4B_u8BD5"><a href="#u6B63_u5F0F_u5F00_u59CB_u6743_u9650_u6D4B_u8BD5" class="headerlink" title="正式开始权限测试"></a>正式开始权限测试</h4><p>搞了这么多,目录结构也比较复杂了, 可以开始子目录的权限控制测试了</p>
<p>现在进行用户规划管理</p>
<p>admin 拥有project1所有的控制权限</p>
<p>cto 拥有code目录以及子目录的权限</p>
<p>in_user 拥有inner 目录的权限</p>
<p>ou_user 拥有outer 目录的权限</p>
<p>authz文件(才发现直接修改配置文件, 不用重启 svn 就能生效)</p>
<pre><code>[groups]
cto = ctouser
in_user = hxk
ou_user = cn

[svndata:/project1]
@cto = r

[svndata:/project1/trunk/code]
@cto = rw
</code></pre><p>checkout 试试</p>
<pre><code>$ svn co   svn://test.svn.cn/project1/trunk/code  --username ctouser
A    code/php
A    code/php/everinner_app
A    code/php/everinner_app/conf
A    code/php/everinner_app/conf/config.php    
...    
</code></pre><p>疗效不错,结果发现没有写权限╮(╯_╰)╭</p>
<p>结果都是泪啊:</p>
<p><em>用户在父目录的权限会把子目录的给覆盖​, 无法进行有效的用户权限控制.</em></p>
<p>你可能会说, 直接在子目录给权限不就行了, 抱歉, 这样连根目录的读权限都没有, 是不能通过验证的</p>
<p>日了🐶    </p>
<p>扩展阅读:</p>
<p><a href="http://developer.51cto.com/art/201005/201718.htm" target="_blank" rel="external">SVN中tag branch trunk用法详解</a>    </p>
<p>参考:</p>
<p><a href="http://blog.csdn.net/pttaag/article/details/8076210" target="_blank" rel="external">SVN的标准目录结构：trunk、branches、tags</a></p>
<p><a href="http://huguiqi.com/2016/03/07/linux%E4%B8%8BSVN%E4%BB%93%E5%BA%93%E9%97%B4%E6%95%B0%E6%8D%AE%E8%BD%AC%E7%A7%BB%E6%88%96%E9%87%8D%E5%91%BD%E5%90%8D/" target="_blank" rel="external">linux下SVN仓库间数据转移或重命名</a></p>
<p><a href="http://holbrook.github.io/2014/01/29/svn_install_config_and_mgnt.html" target="_blank" rel="external">subversion安装、配置和管理</a></p>
<p><a href="http://hushicai.com/2014/03/06/ming-ling-xing-zhong-hui-gun-svn.html" target="_blank" rel="external">命令行中回滚svn</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u8D77_u56E0"><a href="#u8D77_u56E0" class="headerlink" title="起因"></a>起因</h3><p>由于之前的同事没有好好规划 svn 仓库结构, 现需要重新规划目录结构如下:</p>
<pre><code>project1
    ├── branches
    ├── tags
    └── trunk
        ├── code
        │   ├── andriod
        │   ├── ios
        │   ├── php
        │   └── sql
        ├── doc
        └── readme.txt
</code></pre><p><strong>trunk</strong>是主分支，是日常开发进行的地方。</p>
<p><strong>branches</strong>是分支。一些阶段性的release版本，这些版本是可以继续进行开发和维护的，则放在branches目录中。又比如为不同用户客制化的版本，也可以放在分支中进行开发。</p>
<p><strong>tags</strong>目录一般是只读的，这里存储阶段性的发布版本，只是作为一个里程碑的版本进行存档。    </p>
<p>现在需要将分散的代码仓库都迁移放到 <em>trunk-code</em> 目录下进行分类存放, 并规划相应仓库的人员权限</p>]]>
    
    </summary>
    
      <category term="svn" scheme="http://yoursite.com/tags/svn/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Shell数组]]></title>
    <link href="http://yoursite.com/2016/04/08/Shell%E6%95%B0%E7%BB%84/"/>
    <id>http://yoursite.com/2016/04/08/Shell数组/</id>
    <published>2016-04-08T03:19:37.000Z</published>
    <updated>2016-04-14T01:44:33.000Z</updated>
    <content type="html"><![CDATA[<h3 id="Linux_Shell_u4E2D_u7684_u6570_u7EC4_u53CA_u904D_u5386"><a href="#Linux_Shell_u4E2D_u7684_u6570_u7EC4_u53CA_u904D_u5386" class="headerlink" title="Linux Shell中的数组及遍历"></a><a href="http://blog.csdn.net/redhat456/article/details/6068409" target="_blank" rel="external">Linux Shell中的数组及遍历</a></h3><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数组赋值</span></span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># a=(1 2 3 b c d)</span></span><br><span class="line"><span class="comment"># 调用数组元素</span></span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># echo $&#123;a[0]&#125;</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># echo $&#123;a[1]&#125;</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># echo $&#123;a[3]&#125;</span></span><br><span class="line">b    </span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># echo $&#123;a[@]&#125;</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> b c d</span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># for i in $&#123;a[@]&#125;; do echo $i; done</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br></pre></td></tr></table></figure>
<a id="more"></a>]]></content>
    <summary type="html">
    <![CDATA[<h3 id="Linux_Shell_u4E2D_u7684_u6570_u7EC4_u53CA_u904D_u5386"><a href="#Linux_Shell_u4E2D_u7684_u6570_u7EC4_u53CA_u904D_u5386" class="headerlink" title="Linux Shell中的数组及遍历"></a><a href="http://blog.csdn.net/redhat456/article/details/6068409">Linux Shell中的数组及遍历</a></h3><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数组赋值</span></span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># a=(1 2 3 b c d)</span></span><br><span class="line"><span class="comment"># 调用数组元素</span></span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># echo $&#123;a[0]&#125;</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># echo $&#123;a[1]&#125;</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># echo $&#123;a[3]&#125;</span></span><br><span class="line">b    </span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># echo $&#123;a[@]&#125;</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> b c d</span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~</span><span class="comment"># for i in $&#123;a[@]&#125;; do echo $i; done</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="shell" scheme="http://yoursite.com/tags/shell/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[centos7 安装破解confluence 5.8]]></title>
    <link href="http://yoursite.com/2016/04/05/centos7-%E5%AE%89%E8%A3%85%E7%A0%B4%E8%A7%A3confluence-5-8/"/>
    <id>http://yoursite.com/2016/04/05/centos7-安装破解confluence-5-8/</id>
    <published>2016-04-05T03:09:57.000Z</published>
    <updated>2016-04-12T02:38:32.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u5B89_u88C5_jdk"><a href="#u5B89_u88C5_jdk" class="headerlink" title="安装 jdk"></a>安装 jdk</h3><pre><code>$ yum install -y java-1.7.0-openjdk.x86_64
$ java -version
java version &quot;1.7.0_99&quot;
OpenJDK Runtime Environment (rhel-2.6.5.0.el7_2-x86_64 u99-b00)
OpenJDK 64-Bit Server VM (build 24.95-b01, mixed mode)
</code></pre><a id="more"></a>
<h3 id="u5B89_u88C5_u6570_u636E_u5E93"><a href="#u5B89_u88C5_u6570_u636E_u5E93" class="headerlink" title="安装数据库"></a>安装数据库</h3><p><del>本来打算直接用 mariadb 的, 但是 confluence 不支持这个驱动.只能另外装 mysql 了, 下面这小段作废, 直接跳 mysql 安装</del></p>
<pre><code>yum install -y mariadb*
systemctl start mariadb.service
systemctl enable mariadb.service
mysql_secure_installation  #一路 yes 下去

#解决中文乱码问题
vim /etc/my.cnf
[mysqld]
character-set-server =utf8
重启服务
</code></pre><p>centos7 yum 源不带 mysql, 需要自己安装 yum 源</p>
<pre><code>wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm
rpm -ivh mysql-community-release-el7-5.noarch.rpm
yum install mysql-server
</code></pre><h3 id="u5F00_u59CB_u5B89_u88C5_confluence"><a href="#u5F00_u59CB_u5B89_u88C5_confluence" class="headerlink" title="开始安装 confluence"></a>开始安装 confluence</h3><pre><code>$ chmod u+x /usr/local/confluence-5.8.10-x64.bin
$ /usr/local/confluence-5.8.10-x64.bin
Unpacking JRE ...
Starting Installer ...
四月 05, 2016 3:13:16 下午 java.util.prefs.FileSystemPreferences$1 run
INFO: Created user preferences directory.

This will install Confluence 5.8.10 on your computer.
OK [o, Enter], Cancel [c]

Choose the appropriate installation or upgrade option.
Please choose one of the following:
Express Install (uses default settings) [1],
Custom Install (recommended for advanced users) [2, Enter],
Upgrade an existing Confluence installation [3]
1
See where Confluence will be installed and the settings that will be used.
Installation Directory: /opt/atlassian/confluence
Home Directory: /var/atlassian/application-data/confluence
HTTP Port: 8090
RMI Port: 8000
Install as service: Yes
Install [i, Enter], Exit [e]
i
</code></pre><p>http访问</p>
<pre><code>http://your.centos.ip:8090
</code></pre><p>点击安装, 记录 serverid : BH9S-DN8I-F20N-QN2C</p>
<p><img src="http://7xpsj5.com1.z0.glb.clouddn.com/confluence-crack1.png" alt="confluence-crack1"></p>
<h3 id="u7834_u89E3"><a href="#u7834_u89E3" class="headerlink" title="破解"></a>破解</h3><p>停止wiki服务, 进行破解</p>
<pre><code>$ /etc/init.d/confluence stop
executing using dedicated user
If you encounter issues starting up Confluence, please see the Installation guide at http://confluence.atlassian.com/display/DOC/Confluence+Installation+Guide

Server startup logs are located in /opt/atlassian/confluence/logs/catalina.out
Using CATALINA_BASE:   /opt/atlassian/confluence
Using CATALINA_HOME:   /opt/atlassian/confluence
Using CATALINA_TMPDIR: /opt/atlassian/confluence/temp
Using JRE_HOME:        /opt/atlassian/confluence/jre/
Using CLASSPATH:       /opt/atlassian/confluence/bin/bootstrap.jar:/opt/atlassian/confluence/bin/tomcat-juli.jar
Using CATALINA_PID:    /opt/atlassian/confluence/work/catalina.pid
Tomcat stopped.


cp /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.2.jar /tmp/atlassian-extras-2.4.jar
</code></pre><p>破解将在 mac 本地进行, 因为需要图形界面…</p>
<pre><code>➜ /Users/cristaly7/tmp &gt;scp -r HD_Server_Config:/root/confluence5.8/confluence5.1-crack .
➜ /Users/cristaly7/tmp &gt;cd confluence5.1-crack/iNViSiBLE
➜ /Users/cristaly7/tmp/confluence5.1-crack/iNViSiBLE &gt;chmod u+x keygen_MacOSX.sh

# 按照网上的文章运行命令
/System/Library/Frameworks/JavaVM.framework/Versions/1.6/Home/bin/java -jar confluence_keygen.jar
zsh: no such file or directory: /System/Library/Frameworks/JavaVM.framework/Versions/1.6/Home/bin/java
➜ /Users/cristaly7/tmp/confluence5.1-crack/iNViSiBLE &gt;java -v
No Java runtime present, requesting install.
</code></pre><p>没有java, 需要安装 java</p>
<p><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">下载 java</a>  </p>
<p>运行破解程序</p>
<pre><code>➜ /Users/cristaly7/tmp/confluence5.1-crack/iNViSiBLE &gt;java -jar confluence_keygen.jar
</code></pre><p>输入 serverid , 点击. patch</p>
<p><img src="http://7xpsj5.com1.z0.glb.clouddn.com/confluence-crack2.png" alt=""></p>
<p>选择 <code>confluence5.1-crack</code> 文件夹里的 <code>atlassian-extras-2.4.jar</code> </p>
<p><img src="http://7xpsj5.com1.z0.glb.clouddn.com/confluence-crack3.png" alt=""></p>
<p>点击.gen 会生成 key, 并且<code>confluence5.1-crack</code> 文件夹会多出一个<code>atlassian-extras-2.4.bak</code></p>
<p><img src="http://7xpsj5.com1.z0.glb.clouddn.com/confluence-crack4.png" alt=""></p>
<p>拷贝破解的文件到安装目录进行覆盖</p>
<pre><code>➜ /Users/cristaly7/tmp/confluence5.1-crack &gt;scp atlassian-extras-2.4.jar HD_Server_Config:/opt/atlassian/confluence/confluence/WEB-INF/lib
</code></pre><p>开启 wiki 服务</p>
<pre><code>$ service confluence start
</code></pre><p>在 License key 那里输入刚才生成的 key</p>
<p>拷贝 mysql 驱动</p>
<pre><code>cp mysql-connector-java-5.1.32-bin.jar  /opt/atlassian/confluence/confluence/WEB-INF/lib/
</code></pre><p>重启服务</p>
<pre><code>service confluence restart
</code></pre><h3 id="u5B89_u88C5_u9875_u9762_u914D_u7F6E"><a href="#u5B89_u88C5_u9875_u9762_u914D_u7F6E" class="headerlink" title="安装页面配置"></a>安装页面配置</h3><p>在页面上，选择数据库“MySQL”，点击“ Externam Database”</p>
<p>登录mysql 创建数据库及账号</p>
<pre><code>mysql -uroot -p
create database wiki character set UTF8;
grant all on wiki.* to wiki_user@&quot;%&quot; identified by &quot;wiki_password&quot;;
</code></pre><p>我这里装的是 percona 5.6</p>
<p>确定存储引擎是 InnoDB</p>
<p>在页面上点击“Direct JDBC”</p>
<p>填写db信息</p>
<p>Driver Class Name不用变</p>
<p>Database URL，修正对应ip、port、database，例如：</p>
<pre><code>jdbc:mysql://localhost:3306/wiki?useUnicode=true&amp;characterEncoding=UTF8&amp;sessionVariables=storage_engine%3DInnoDB
</code></pre><p>上面的连接符是”<code>&amp;amp;</code>”不是”&amp;”，这样是没有问题的，如果你要用”&amp;”也可以尝试，但后面可能出错</p>
<p>点击“Next”，此时可能会有一个比较长的等待，如果此处出错了，停掉wiki服务，卸载wiki，删掉wiki文件，卸载数据库，从第一步重新来。</p>
<p>如果上一步成功的话，点击“Empty Site”。你也可以点击“Example Site”</p>
<p>点击“Manage users and groups within Confluence”，设置管理员相关信息。这里是“下一步”还是“确定”忘了，点击即可</p>
<h3 id="u57FA_u672C_u4F7F_u7528"><a href="#u57FA_u672C_u4F7F_u7528" class="headerlink" title="基本使用"></a>基本使用</h3><h3 id="u5751"><a href="#u5751" class="headerlink" title="坑"></a>坑</h3><h4 id="u90AE_u4EF6_u914D_u7F6E_u4E0D_u80FD_u6210_u529F"><a href="#u90AE_u4EF6_u914D_u7F6E_u4E0D_u80FD_u6210_u529F" class="headerlink" title="邮件配置不能成功"></a>邮件配置不能成功</h4><p>无论是直接配置 smtp, 还是修改配置文件配置 JNxx的, 都不行</p>
<p>配置 smtp 直接说验证失败</p>
<p>配置 JNxx 的, 每次一点击测试邮件发送, 就找不到页面, 并且网上也没有解决方案, 太令人暴躁了</p>
<h4 id="u4E0A_u4F20_u7684_doc__u4E2D_u6587_u9644_u4EF6_u663E_u793A_u4E71_u7801"><a href="#u4E0A_u4F20_u7684_doc__u4E2D_u6587_u9644_u4EF6_u663E_u793A_u4E71_u7801" class="headerlink" title="上传的 doc 中文附件显示乱码"></a>上传的 doc 中文附件显示乱码</h4><h4 id="mysql-bin_log__u5F88_u5927_21"><a href="#mysql-bin_log__u5F88_u5927_21" class="headerlink" title="mysql-bin log 很大!"></a>mysql-bin log 很大!</h4><p>什么原因? confluence 刷了很多这样的日志:</p>
<pre><code>&lt;/com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
&lt;com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
  &lt;startDate&gt;2016-04-12 09:29:42.126 CST&lt;/startDate&gt;
  &lt;endDate&gt;2016-04-12 09:29:42.126 CST&lt;/endDate&gt;
&lt;/com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
&lt;com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
  &lt;startDate&gt;2016-04-12 09:44:42.126 CST&lt;/startDate&gt;
  &lt;endDate&gt;2016-04-12 09:44:42.127 CST&lt;/endDate&gt;
&lt;/com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
&lt;com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
  &lt;startDate&gt;2016-04-12 09:59:42.126 CST&lt;/startDate&gt;
  &lt;endDate&gt;2016-04-12 09:59:42.126 CST&lt;/endDate&gt;
&lt;/com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
&lt;com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
  &lt;startDate&gt;2016-04-12 10:14:42.126 CST&lt;/startDate&gt;
  &lt;endDate&gt;2016-04-12 10:14:42.126 CST&lt;/endDate&gt;
&lt;/com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
&lt;com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
  &lt;startDate&gt;2016-04-12 10:29:42.126 CST&lt;/startDate&gt;
  &lt;endDate&gt;2016-04-12 10:29:42.126 CST&lt;/endDate&gt;
&lt;/com.atlassian.confluence.schedule.ScheduledJobHistory&gt;
</code></pre><p><em>General Configuration &gt; Scheduled Jobs</em> 到这里可以进行设置和关闭任务调度, 然而不知道关了会有啥后果, 真是操蛋玩意!</p>
<h4 id="Analytics__u6027_u80FD_u6536_u96C6_u53D1_u9001"><a href="#Analytics__u6027_u80FD_u6536_u96C6_u53D1_u9001" class="headerlink" title="Analytics 性能收集发送"></a>Analytics 性能收集发送</h4><p>这个会收集 confluence 使用情况发送到 confluence 公司….尼玛老子用的破解版的啊, 还发送, 果断关闭</p>
<p>未完待续….</p>
<p>参考:</p>
<p><a href="http://www.jianshu.com/p/d7e253db24d9" target="_blank" rel="external">创业工具之知识管理：Confluence</a></p>
<p><a href="http://www.jianshu.com/p/27cb54b4a81a" target="_blank" rel="external">知识管理Confluence：常用基本操作</a></p>
<p><a href="http://www.tuicool.com/articles/7FvuMn" target="_blank" rel="external">CentOS安装confluence(WIKI)</a></p>
<p><a href="http://www.centoscn.com/image-text/install/2015/1121/6441.html" target="_blank" rel="external">centos安装confluence及破解</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u5B89_u88C5_jdk"><a href="#u5B89_u88C5_jdk" class="headerlink" title="安装 jdk"></a>安装 jdk</h3><pre><code>$ yum install -y java-1.7.0-openjdk.x86_64
$ java -version
java version &quot;1.7.0_99&quot;
OpenJDK Runtime Environment (rhel-2.6.5.0.el7_2-x86_64 u99-b00)
OpenJDK 64-Bit Server VM (build 24.95-b01, mixed mode)
</code></pre>]]>
    
    </summary>
    
      <category term="confluence" scheme="http://yoursite.com/tags/confluence/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[mac os 安装使用postgresql]]></title>
    <link href="http://yoursite.com/2016/04/01/mac-os-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8postgresql/"/>
    <id>http://yoursite.com/2016/04/01/mac-os-安装使用postgresql/</id>
    <published>2016-04-01T08:42:33.000Z</published>
    <updated>2016-04-08T03:27:53.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h3><pre><code>➜ /Users/cristaly7/Desktop/15/15 &gt;brew install postgres
==&gt; Downloading https://homebrew.bintray.com/bottles/postgresql-9.4.5_2.el_capitan.bottle.tar.gz
######################################################################## 100.0%
==&gt; Pouring postgresql-9.4.5_2.el_capitan.bottle.tar.gz
==&gt; Caveats
If builds of PostgreSQL 9 are failing and you have version 8.x installed,
you may need to remove the previous version first. See:
  https://github.com/Homebrew/homebrew/issues/2510

To migrate existing data from a previous major version (pre-9.4) of PostgreSQL, see:
  https://www.postgresql.org/docs/9.4/static/upgrading.html

To load postgresql:
  launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
Or, if you don&apos;t want/need launchctl, you can just run:
  postgres -D /usr/local/var/postgres
==&gt; Summary
🍺  /usr/local/Cellar/postgresql/9.4.5_2: 3,021 files, 33.7M
</code></pre><a id="more"></a>
<h3 id="u521D_u59CB_u5316"><a href="#u521D_u59CB_u5316" class="headerlink" title="初始化"></a>初始化</h3><pre><code>➜ /Users/cristaly7 &gt;initdb ~/postgresql
The files belonging to this database system will be owned by user &quot;cristaly7&quot;.
This user must also own the server process.

The database cluster will be initialized with locales
  COLLATE:  en_US.UTF-8
  CTYPE:    zh_CN.UTF-8
  MESSAGES: en_US.UTF-8
  MONETARY: en_US.UTF-8
  NUMERIC:  en_US.UTF-8
  TIME:     en_US.UTF-8
The default database encoding has accordingly been set to &quot;UTF8&quot;.
initdb: could not find suitable text search configuration for locale &quot;zh_CN.UTF-8&quot;
The default text search configuration will be set to &quot;simple&quot;.

Data page checksums are disabled.

creating directory /Users/cristaly7/postgresql ... ok
creating subdirectories ... ok
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting dynamic shared memory implementation ... posix
creating configuration files ... ok
creating template1 database in /Users/cristaly7/postgresql/base/1 ... ok
initializing pg_authid ... ok
initializing dependencies ... ok
creating system views ... ok
loading system objects&apos; descriptions ... ok
creating collations ... ok
creating conversions ... ok
creating dictionaries ... ok
setting privileges on built-in objects ... ok
creating information schema ... ok
loading PL/pgSQL server-side language ... ok
vacuuming database template1 ... ok
copying template1 to template0 ... ok
copying template1 to postgres ... ok
syncing data to disk ... ok

WARNING: enabling &quot;trust&quot; authentication for local connections
You can change this by editing pg_hba.conf or using the option -A, or
--auth-local and --auth-host, the next time you run initdb.

Success. You can now start the database server using:

    postgres -D /Users/cristaly7/postgresql
or
    pg_ctl -D /Users/cristaly7/postgresql -l logfile start
</code></pre><h3 id="u542F_u52A8_u4E0E_u505C_u6B62"><a href="#u542F_u52A8_u4E0E_u505C_u6B62" class="headerlink" title="启动与停止"></a>启动与停止</h3><pre><code>➜ /Users/cristaly7 &gt;pg_ctl -D /Users/cristaly7/postgresql -l ~/postgresql/logfile start
server starting

➜ /Users/cristaly7 &gt;pg_ctl -D ~/postgresql stop -s -m fast
</code></pre><p>### </p>
<p>参考:</p>
<p><a href="http://blog.everlose.com/mac-homebrew-postgresql.html" target="_blank" rel="external">Mac下使用homebrew安装postgresql及配置</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h3><pre><code>➜ /Users/cristaly7/Desktop/15/15 &gt;brew install postgres
==&gt; Downloading https://homebrew.bintray.com/bottles/postgresql-9.4.5_2.el_capitan.bottle.tar.gz
######################################################################## 100.0%
==&gt; Pouring postgresql-9.4.5_2.el_capitan.bottle.tar.gz
==&gt; Caveats
If builds of PostgreSQL 9 are failing and you have version 8.x installed,
you may need to remove the previous version first. See:
  https://github.com/Homebrew/homebrew/issues/2510

To migrate existing data from a previous major version (pre-9.4) of PostgreSQL, see:
  https://www.postgresql.org/docs/9.4/static/upgrading.html

To load postgresql:
  launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
Or, if you don&apos;t want/need launchctl, you can just run:
  postgres -D /usr/local/var/postgres
==&gt; Summary
🍺  /usr/local/Cellar/postgresql/9.4.5_2: 3,021 files, 33.7M
</code></pre>]]>
    
    </summary>
    
      <category term="os x" scheme="http://yoursite.com/tags/os-x/"/>
    
      <category term="postgresql" scheme="http://yoursite.com/tags/postgresql/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[nginx打开目录浏览功能(autoindex)]]></title>
    <link href="http://yoursite.com/2016/03/29/nginx%E6%89%93%E5%BC%80%E7%9B%AE%E5%BD%95%E6%B5%8F%E8%A7%88%E5%8A%9F%E8%83%BD-autoindex/"/>
    <id>http://yoursite.com/2016/03/29/nginx打开目录浏览功能-autoindex/</id>
    <published>2016-03-29T03:27:44.000Z</published>
    <updated>2016-04-05T02:46:59.000Z</updated>
    <content type="html"><![CDATA[<pre><code>server {
        server_name hook.123.cn;
        root /opt/www/svnhook/document/php;
        location / {
                autoindex on;
                autoindex_localtime on;
                charset utf-8,gbk;  # 解决中文乱码

                # 认证登陆
                auth_basic            &quot;Password please&quot;;
                auth_basic_user_file  /etc/nginx/htpasswd;


                index 投标单位管理.html;
                if (!-e $request_filename) {
                        rewrite ^(.*)$  /manage.html last;
                }
        }
}
</code></pre><p><code>/etc/nginx/htpasswd</code> 记得修改为 nginx 的权限 , 账号密码可以通过在线的htpasswd生成器生成</p>
<p><a href="http://blog.licess.com/nginx-autoindex/" target="_blank" rel="external">nginx打开目录浏览功能(autoindex)</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<pre><code>server {
        server_name hook.123.cn;
        root /opt/www/svnhook/document/php;
        location / {
                autoin]]>
    </summary>
    
      <category term="nginx" scheme="http://yoursite.com/tags/nginx/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用rsync]]></title>
    <link href="http://yoursite.com/2016/03/28/%E4%BD%BF%E7%94%A8rsync/"/>
    <id>http://yoursite.com/2016/03/28/使用rsync/</id>
    <published>2016-03-28T07:57:13.000Z</published>
    <updated>2016-03-28T08:00:56.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u62F7_u8D1D_u6587_u4EF6_u5939_u9664_u4E86_u5E26_mysql__u4E4B_u5916_u7684_u6587_u4EF6"><a href="#u62F7_u8D1D_u6587_u4EF6_u5939_u9664_u4E86_u5E26_mysql__u4E4B_u5916_u7684_u6587_u4EF6" class="headerlink" title="拷贝文件夹除了带 mysql 之外的文件"></a>拷贝文件夹除了带 mysql 之外的文件</h3><pre><code>rsync -av --exclude &apos;*mysql*&apos; root@server:/home/eg/php2 /home/php

-a for archive (mostly all files)
-v for verbose output
</code></pre><p><a href="http://stackoverflow.com/questions/1228466/how-to-filter-files-when-using-scp-to-copy-dir-recursively" target="_blank" rel="external">How to filter files when using scp to copy dir recursively?</a></p>
<p>顺便学习到了ls 的这种用法</p>
<pre><code>ls --ignore=*mysql* 
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u62F7_u8D1D_u6587_u4EF6_u5939_u9664_u4E86_u5E26_mysql__u4E4B_u5916_u7684_u6587_u4EF6"><a href="#u62F7_u8D1D_u6587_u4EF6_u5939_u9664_]]>
    </summary>
    
      <category term="rsync" scheme="http://yoursite.com/tags/rsync/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[centos7常用命令]]></title>
    <link href="http://yoursite.com/2016/03/25/centos7%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>http://yoursite.com/2016/03/25/centos7常用命令/</id>
    <published>2016-03-25T07:30:43.000Z</published>
    <updated>2016-03-31T03:25:12.000Z</updated>
    <content type="html"><![CDATA[<p>其实这些东西大部分 ansible 都能做</p>
<h3 id="systemd__u76F8_u5173"><a href="#systemd__u76F8_u5173" class="headerlink" title="systemd 相关"></a>systemd 相关</h3><p>设置开机自启动命令</p>
<pre><code>启动nginx服务
systemctl start nginx.service
设置开机自启动
systemctl enable nginx.service
停止开机自启动
systemctl disable nginx.service
查看服务当前状态
systemctl status nginx.service
重新启动服务
systemctl restart nginx.service
查看所有已启动的服务
systemctl list-units --type=service
</code></pre><h3 id="u67E5_u770B_u7CFB_u7EDF_u7248_u672C"><a href="#u67E5_u770B_u7CFB_u7EDF_u7248_u672C" class="headerlink" title="查看系统版本"></a>查看系统版本</h3><pre><code>$ cat /etc/redhat-release
CentOS Linux release 7.2.1511 (Core)
</code></pre><h3 id="u9632_u706B_u5899"><a href="#u9632_u706B_u5899" class="headerlink" title="防火墙"></a>防火墙</h3><p>客户端命令firewalld可以用来修改firewalld的永久配置或者运行时配置。firewalld的配置文件保存在<code>/usr/lib/firewalld/</code> 和 <code>/etc/firewalld/</code>中，其中前者是默认的配置，请不要修改。可以在<code>/etc/firewalld/</code>中编辑自己的配置，firewalld优先使用<code>/etc/firewalld/</code>中的配置。</p>
<p><a href="http://mlworks.cn/posts/Redhat7-Centos7-firewalld/" target="_blank" rel="external">Redhat 7与Centos 7中的防火墙Firewalld</a></p>
<p><a href="https://argcv.com/articles/3167.c" target="_blank" rel="external">CentOS 7 下使用 iptables</a></p>
<pre><code>service iptables save #保存设置
iptables-save &gt; /etc/iptables.save  #导出设置
iptables-restore /etc/iptables.save #导入设置

原先的 iptables 脚本在K`/usr/libexec/iptables/iptables.init`
可以拷贝用..
cp /usr/libexec/iptables/iptables.init /etc/init.d/iptables
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<p>其实这些东西大部分 ansible 都能做</p>
<h3 id="systemd__u76F8_u5173"><a href="#systemd__u76F8_u5173" class="headerlink" title="systemd 相关"></a>systemd]]>
    </summary>
    
      <category term="Centos 7" scheme="http://yoursite.com/tags/Centos-7/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[mysql 使用随记]]></title>
    <link href="http://yoursite.com/2016/03/25/mysql-%E4%BD%BF%E7%94%A8%E9%9A%8F%E8%AE%B0/"/>
    <id>http://yoursite.com/2016/03/25/mysql-使用随记/</id>
    <published>2016-03-25T06:31:28.000Z</published>
    <updated>2016-04-08T16:38:02.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u514D_u5BC6_u7801_u767B_u9646"><a href="#u514D_u5BC6_u7801_u767B_u9646" class="headerlink" title="免密码登陆"></a>免密码登陆</h3><p>默认使用~/.my.cnf</p>
<pre><code>$ vim ~/.my.cnf
[client]
password=your_pass
user=your_user
$ chmod 400 ~/.my.cnf
</code></pre><p>也可以指定特定文件</p>
<pre><code>$ mysql --defaults-file=/home/imlonghao/mysql-opts
</code></pre><h3 id="mysql__u5907_u4EFD"><a href="#mysql__u5907_u4EFD" class="headerlink" title="mysql 备份"></a>mysql 备份</h3><p>创建备份用户</p>
<pre><code># 创建一个只允许本地登录的backup用户，密码为12345。
CREATE USER &apos;backup&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;12345&apos;; 

# 增加EVENT,LOCK TABLES,SELECT,SHOW DATABASES等权限，这是MySQL官方工具建议的BackupAdmin角色应该拥有的权限。
GRANT EVENT,LOCK TABLES,SELECT,SHOW DATABASES ON  *.* TO &apos;backup&apos;@&apos;localhost&apos; ;

# 刷新权限，使刚添加的用户生效。
FLUSH PRIVILEGES;
</code></pre><p>创建备份目录</p>
<pre><code>$ mkdir -p /data/backup/shell
$ mkdir /data/backup//mysql
$ cd /data/backup/shell
</code></pre><p>备份脚本</p>
<pre><code>$ vim mysql_backup.sh

#!/bin/bash


# 备份
DB=bid
MYSQL_PATH=/opt/mysql/bin/
BACKUP_DIR=/data/backup/mysql/
USER=backup
PASSWD=backup123
$MYSQL_PATH/mysqldump -hlocalhost -u$USER -p$PASSWD $DB  &gt; $BACKUP_DIR/$DB$(date -d &quot;today&quot; +&quot;%Y%m%d_%H%M%S&quot;).sql.gz 2&gt;&gt; /tmp/backup.err

if [ $? -eq 0 ]; then
    echo `date  +&quot;%Y-%m-%d %H:%M:%S&quot;`&quot;  mysql backup succeeded!&quot; &gt;&gt; /var/log/cron
else
    echo `date  +&quot;%Y-%m-%d %H:%M:%S&quot;`&quot;  mysql backup failed!&quot; &gt;&gt; /var/log/cron
fi


# 删除10天前的备份文件
find $BACKUP_DIR -mtime +10 -name &quot;*.sql&quot; -type f -exec rm -rf {} \;
</code></pre><p>修改一下脚本权限</p>
<pre><code>$ chmod 700 mysql_backup.sh
</code></pre><p>编辑 crontab</p>
<pre><code>$ crontab -e
0 */2 * * * sh /data/backup/shell/mysql_backup.sh
</code></pre><a id="more"></a>
<h4 id="u5907_u4EFD_u8868_u7ED3_u6784"><a href="#u5907_u4EFD_u8868_u7ED3_u6784" class="headerlink" title="备份表结构"></a>备份表结构</h4><p>导出數據库為dbname的表结构（其中用戶名為root,密码為dbpasswd,生成的脚本名為db.sql）</p>
<pre><code>mysqldump -uroot -pdbpasswd -d dbname &gt;db.sql;
</code></pre><h3 id="u5E38_u7528_u547D_u4EE4"><a href="#u5E38_u7528_u547D_u4EE4" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="create_table"><a href="#create_table" class="headerlink" title="create table"></a>create table</h4><pre><code>create table `user` (  
`id` int(11) not null auto_increment, 
`name` varchar(100) default null,
 primary key (`id`))    
</code></pre><h4 id="insert_into__u63D2_u5165_u6570_u636E"><a href="#insert_into__u63D2_u5165_u6570_u636E" class="headerlink" title="insert into 插入数据"></a>insert into 插入数据</h4><pre><code>insert into user (name) values (&apos;bob&apos;);
insert into user (name) values (&apos;mark&apos;);
</code></pre><h4 id="truncate__u6E05_u7A7A_u8868"><a href="#truncate__u6E05_u7A7A_u8868" class="headerlink" title="truncate 清空表"></a>truncate 清空表</h4><pre><code>truncate table user;
</code></pre><h3 id="AB_u4E3B_u4ECE"><a href="#AB_u4E3B_u4ECE" class="headerlink" title="AB主从"></a>AB主从</h3><p>配置方法网上很多…自己找去吧 </p>
<h4 id="u4E3B_u4ECE_u707E_u96BE_u6062_u590D_u6F14_u7EC3"><a href="#u4E3B_u4ECE_u707E_u96BE_u6062_u590D_u6F14_u7EC3" class="headerlink" title="主从灾难恢复演练"></a>主从灾难恢复演练</h4><h3 id="u6253_u5F00_general_log"><a href="#u6253_u5F00_general_log" class="headerlink" title="打开 general_log"></a>打开 general_log</h3><p><a href="http://blog.itpub.net/25704976/viewspace-1251022/" target="_blank" rel="external">MySQL开启general log</a></p>
<pre><code>mysql&gt;show variables like %general_log%;
mysql&gt;set global general_log_file=&apos;/tmp/general.log&apos;;
mysql&gt;set global general_log=on;
mysql&gt;set global general_log=off;
</code></pre><p>参考:</p>
<p><a href="http://www.cnblogs.com/yuanyouqi/archive/2010/04/28/1722738.html" target="_blank" rel="external">Mysql导出表结构及表数据 mysqldump用法</a></p>
<p><a href="http://wangwei007.blog.51cto.com/68019/965575" target="_blank" rel="external">Mysql数据库主从心得整理</a>  </p>
<p><a href="http://ucode.blog.51cto.com/10837891/1747078" target="_blank" rel="external">MySQL主从复制之主库宕机处理</a></p>
<p><a href="http://blog.csdn.net/JesseYoung/article/details/41211841" target="_blank" rel="external">mysql备份还原-基于binlog的增量备份还原</a>    </p>
<p><a href="http://ifxoxo.com/mysql_binlog.html" target="_blank" rel="external">从mysql的binlog恢复数据的步骤</a></p>
<p><a href="http://lizhenliang.blog.51cto.com/7876557/1669829" target="_blank" rel="external">不停止MySQL服务增加从库的两种方式</a></p>
<p><a href="https://imlonghao.com/7.html" target="_blank" rel="external">Shell 下免密码快速登陆 MySQL 数据库</a></p>
<p><a href="http://www.zzbaike.com/wiki/CentOS/%E4%BD%BF%E7%94%A8tar%E5%A4%87%E4%BB%BD" target="_blank" rel="external">tar备份</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u514D_u5BC6_u7801_u767B_u9646"><a href="#u514D_u5BC6_u7801_u767B_u9646" class="headerlink" title="免密码登陆"></a>免密码登陆</h3><p>默认使用~/.my.cnf</p>
<pre><code>$ vim ~/.my.cnf
[client]
password=your_pass
user=your_user
$ chmod 400 ~/.my.cnf
</code></pre><p>也可以指定特定文件</p>
<pre><code>$ mysql --defaults-file=/home/imlonghao/mysql-opts
</code></pre><h3 id="mysql__u5907_u4EFD"><a href="#mysql__u5907_u4EFD" class="headerlink" title="mysql 备份"></a>mysql 备份</h3><p>创建备份用户</p>
<pre><code># 创建一个只允许本地登录的backup用户，密码为12345。
CREATE USER &apos;backup&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;12345&apos;; 

# 增加EVENT,LOCK TABLES,SELECT,SHOW DATABASES等权限，这是MySQL官方工具建议的BackupAdmin角色应该拥有的权限。
GRANT EVENT,LOCK TABLES,SELECT,SHOW DATABASES ON  *.* TO &apos;backup&apos;@&apos;localhost&apos; ;

# 刷新权限，使刚添加的用户生效。
FLUSH PRIVILEGES;
</code></pre><p>创建备份目录</p>
<pre><code>$ mkdir -p /data/backup/shell
$ mkdir /data/backup//mysql
$ cd /data/backup/shell
</code></pre><p>备份脚本</p>
<pre><code>$ vim mysql_backup.sh

#!/bin/bash


# 备份
DB=bid
MYSQL_PATH=/opt/mysql/bin/
BACKUP_DIR=/data/backup/mysql/
USER=backup
PASSWD=backup123
$MYSQL_PATH/mysqldump -hlocalhost -u$USER -p$PASSWD $DB  &gt; $BACKUP_DIR/$DB$(date -d &quot;today&quot; +&quot;%Y%m%d_%H%M%S&quot;).sql.gz 2&gt;&gt; /tmp/backup.err

if [ $? -eq 0 ]; then
    echo `date  +&quot;%Y-%m-%d %H:%M:%S&quot;`&quot;  mysql backup succeeded!&quot; &gt;&gt; /var/log/cron
else
    echo `date  +&quot;%Y-%m-%d %H:%M:%S&quot;`&quot;  mysql backup failed!&quot; &gt;&gt; /var/log/cron
fi


# 删除10天前的备份文件
find $BACKUP_DIR -mtime +10 -name &quot;*.sql&quot; -type f -exec rm -rf {} \;
</code></pre><p>修改一下脚本权限</p>
<pre><code>$ chmod 700 mysql_backup.sh
</code></pre><p>编辑 crontab</p>
<pre><code>$ crontab -e
0 */2 * * * sh /data/backup/shell/mysql_backup.sh
</code></pre>]]>
    
    </summary>
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[mac环境]]></title>
    <link href="http://yoursite.com/2016/03/25/mac%E7%8E%AF%E5%A2%83/"/>
    <id>http://yoursite.com/2016/03/25/mac环境/</id>
    <published>2016-03-25T03:02:48.000Z</published>
    <updated>2016-04-20T11:47:50.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u5B89_u88C5_svn"><a href="#u5B89_u88C5_svn" class="headerlink" title="安装 svn"></a>安装 svn</h3><p>mac 本身自带了 svn, 只是版本过旧, 用 brew 安装新版的</p>
<pre><code>brew install subversion
</code></pre><p>新开一个窗口</p>
<pre><code>svn --version
svn, version 1.9.3 (r1718519)
</code></pre><h3 id="u5404_u79CD_u5E94_u7528_u8F6F_u4EF6"><a href="#u5404_u79CD_u5E94_u7528_u8F6F_u4EF6" class="headerlink" title="各种应用软件"></a>各种应用软件</h3><p>Filezilla</p>
<p>Potplayer</p>
<p>奇妙清单</p>
<p>Mou</p>
<p>Sequal Pro</p>
<p>MySQLWorkbench</p>
<p>Alfred 2</p>
<h3 id="u5B89_u88C5_u7834_u89E3_Bartender"><a href="#u5B89_u88C5_u7834_u89E3_Bartender" class="headerlink" title="安装破解 Bartender"></a>安装破解 Bartender</h3><p><a href="http://xclient.info/s/bartender.html" target="_blank" rel="external">安装破解 Bartender</a></p>
<p><img src="http://7xpsj5.com1.z0.glb.clouddn.com/Bartender2_patch.png" alt=""></p>
<p><img src="http://7xpsj5.com1.z0.glb.clouddn.com/Bartender2_generate.png" alt=""></p>
<h3 id="u7EC8_u7AEF_u63D0_u793A_u7B26_2C__u52A0_u5165_-bashrc"><a href="#u7EC8_u7AEF_u63D0_u793A_u7B26_2C__u52A0_u5165_-bashrc" class="headerlink" title="终端提示符, 加入 .bashrc"></a>终端提示符, 加入 .bashrc</h3><pre><code>export  PROMPT=&apos;${ret_status}%{$fg_bold[green]%}%p %{$fg[cyan]%}%d %{$fg_bold[blue]%}$(git_prompt_info)%{$fg_bold[blue]%}% $ %{$reset_color%}&apos;
</code></pre><h3 id="u5347_u7EA7_rsync"><a href="#u5347_u7EA7_rsync" class="headerlink" title="升级 rsync"></a>升级 rsync</h3><pre><code>rsync --version
rsync  version 2.6.9  protocol version 29

brew install homebrew/dupes/rsync

rsync --version
rsync  version 3.1.2  protocol version 31
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u5B89_u88C5_svn"><a href="#u5B89_u88C5_svn" class="headerlink" title="安装 svn"></a>安装 svn</h3><p>mac 本身自带了 svn, 只是版本过旧, 用 brew 安装新版的<]]>
    </summary>
    
      <category term="os x" scheme="http://yoursite.com/tags/os-x/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[nginx rewrite]]></title>
    <link href="http://yoursite.com/2016/03/25/nginx-rewrite/"/>
    <id>http://yoursite.com/2016/03/25/nginx-rewrite/</id>
    <published>2016-03-25T02:34:06.000Z</published>
    <updated>2016-04-09T07:19:35.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u7F51_u5740_u8DF3_u8F6C"><a href="#u7F51_u5740_u8DF3_u8F6C" class="headerlink" title="网址跳转"></a>网址跳转</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">	<span class="title">listen</span>       <span class="number">80</span>;</span><br><span class="line">	<span class="title">server_name</span>  www.<span class="number">123</span>.cn <span class="number">123</span>.cn;</span><br><span class="line">	<span class="title">access_log</span> <span class="built_in">off</span>;</span><br><span class="line">	<span class="title">rewrite</span><span class="regexp"> ^/(.*)$</span> <span class="url">http://www.123.com/<span class="variable">$1</span></span> <span class="built_in">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置生效后, 用curl查看一下</p>
<pre><code>$ curl -I www.123.cn
HTTP/1.1 301 Moved Permanently
Server: nginx/1.8.1
Date: Fri, 25 Mar 2016 02:38:44 GMT
Content-Type: text/html
Content-Length: 184
Connection: keep-alive
Location: http://www.123.com/
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u7F51_u5740_u8DF3_u8F6C"><a href="#u7F51_u5740_u8DF3_u8F6C" class="headerlink" title="网址跳转"></a>网址跳转</h3><figure class="highlight ng]]>
    </summary>
    
      <category term="nginx" scheme="http://yoursite.com/tags/nginx/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[svn使用随记]]></title>
    <link href="http://yoursite.com/2016/03/24/svn%E4%BD%BF%E7%94%A8%E9%9A%8F%E8%AE%B0/"/>
    <id>http://yoursite.com/2016/03/24/svn使用随记/</id>
    <published>2016-03-24T01:44:46.000Z</published>
    <updated>2016-04-11T02:51:38.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u521B_u5EFA_u4ED3_u5E93"><a href="#u521B_u5EFA_u4ED3_u5E93" class="headerlink" title="创建仓库"></a>创建仓库</h3><pre><code>svnadmin create /data/svndata/winne  # winne为版本库名称
</code></pre><h3 id="u6DFB_u52A0_u8D26_u6237"><a href="#u6DFB_u52A0_u8D26_u6237" class="headerlink" title="添加账户"></a>添加账户</h3><pre><code>cd /data/svndata/winne/conf
</code></pre><p>编辑 <code>authz</code> 文件, 用户权限</p>
<pre><code>[groups]
admin = bill,ada   
[/]
@admin = rw
[svndata:/document]
@admin     = rw
</code></pre><p>编辑 <code>passwd</code> 文件, 用户的密码</p>
<pre><code>[users]
ada = ada
bill = 123123123123
</code></pre><p>编辑<code>svnserve.conf</code> , 确保有以下配置</p>
<pre><code>[general]
auno-access = none
auth-access = write
password-db = passwd
authz-db = authz
</code></pre><a id="more"></a>
<h3 id="u91CD_u542F_u751F_u6548"><a href="#u91CD_u542F_u751F_u6548" class="headerlink" title="重启生效"></a>重启生效</h3><p>先 kill, 然后</p>
<pre><code>svnserve -d -r /data/svndata/
</code></pre><h3 id="u5C3D_u91CF_u91CD_u547D_u540D_2C__u4E0D_u8981_rm_-rf"><a href="#u5C3D_u91CF_u91CD_u547D_u540D_2C__u4E0D_u8981_rm_-rf" class="headerlink" title="尽量重命名, 不要 rm -rf"></a>尽量重命名, 不要 rm -rf</h3><h3 id="u5907_u4EFD"><a href="#u5907_u4EFD" class="headerlink" title="备份"></a>备份</h3><p>备份脚本:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> != <span class="number">3</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"usage: svn-backup ['full'|'part'] [svn root] [backup dir root]"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"example 1: svn-backup full /opt/svn-repos /opt/svn-backup"</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">mode=<span class="variable">$1</span></span><br><span class="line">svn_root=<span class="variable">$2</span></span><br><span class="line">backup_root=<span class="variable">$3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> project <span class="keyword">in</span> `ls -F <span class="variable">$svn_root</span> | grep /$ | sed <span class="string">'s/\///g'</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    project_dir=<span class="string">"<span class="variable">$svn_root</span>/<span class="variable">$project</span>"</span></span><br><span class="line">    backup_dir=<span class="string">"<span class="variable">$backup_root</span>/<span class="variable">$project</span>"</span></span><br><span class="line">    backup_info=<span class="string">"<span class="variable">$project_dir</span>/backup_info"</span></span><br><span class="line">    last_version=`svnlook youngest <span class="variable">$project_dir</span>`</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ ! <span class="operator">-f</span> <span class="variable">$backup_info</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="number">0</span> &gt; <span class="variable">$backup_info</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    last_backup_version=`cat <span class="variable">$backup_info</span>`</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$mode</span> != <span class="string">'full'</span> ] &amp;&amp; [ <span class="variable">$last_backup_version</span> == <span class="variable">$last_version</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"`date +"</span>%F %R:%S<span class="string">"`  '<span class="variable">$project</span>' nothing to do"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$mode</span> == <span class="string">'full'</span> ] || [ <span class="variable">$last_backup_version</span> == <span class="string">'0'</span> ] || [ ! <span class="operator">-d</span> <span class="variable">$backup_dir</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"`date +"</span>%F %R:%S<span class="string">"`  '<span class="variable">$project</span>' full backup"</span></span><br><span class="line">            rm -rf <span class="variable">$backup_dir</span></span><br><span class="line">            svnadmin hotcopy <span class="variable">$project_dir</span> <span class="variable">$backup_dir</span></span><br><span class="line">            last_version=`svnlook youngest <span class="variable">$backup_dir</span>`</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"`date +"</span>%F %R:%S<span class="string">"`  '<span class="variable">$project</span>' version <span class="variable">$last_backup_version</span> to <span class="variable">$last_version</span>"</span></span><br><span class="line">            backup_file=<span class="string">"<span class="variable">$backup_dir</span>/v<span class="variable">$last_backup_version</span>-<span class="variable">$last_version</span>.bk"</span></span><br><span class="line">            svnadmin dump --incremental -q -r <span class="variable">$last_backup_version</span>:<span class="variable">$last_version</span> <span class="variable">$project_dir</span> &gt; <span class="variable">$backup_file</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$last_version</span> &gt; <span class="variable">$backup_info</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +"</span>%F %R:%S<span class="string">"`  done"</span></span><br></pre></td></tr></table></figure>
<p>配置 crontab:</p>
<pre><code>### 每天凌晨4点进行svn全备份
0 4 * * * sh /data/backup/shell/svn_backup.sh full /data/svndata/ /data/backup/svn/
</code></pre><p>### </p>
<h3 id="u5BA2_u6237_u7AEF_u7684_u4F7F_u7528"><a href="#u5BA2_u6237_u7AEF_u7684_u4F7F_u7528" class="headerlink" title="客户端的使用"></a>客户端的使用</h3><p>我的是 mac os 的, 先用命令行吧… , windows 上面有乌龟的那个客户端, 貌似安装了之后大多操作是通过右键点点点来进行</p>
<h4 id="u521D_u59CB_u5316_u5BFC_u5165"><a href="#u521D_u59CB_u5316_u5BFC_u5165" class="headerlink" title="初始化导入"></a>初始化导入</h4><pre><code>$ svn import ~/Documents/eg/svn/svnhook svn://localhost/testhook --username hooktest --password hooktest -m &quot;初始化导入&quot;
Adding         test1
Committing transaction...
Committed revision 1.
</code></pre><h4 id="u4E0B_u8F7D"><a href="#u4E0B_u8F7D" class="headerlink" title="下载"></a>下载</h4><pre><code>➜ /Users/cristaly7/Documents/svn $ svn checkout svn://120.76.27.38/document --username ksdfhs --password 123456
</code></pre><h4 id="u6DFB_u52A0_u65B0_u6587_u4EF6"><a href="#u6DFB_u52A0_u65B0_u6587_u4EF6" class="headerlink" title="添加新文件"></a>添加新文件</h4><pre><code>svn add file
</code></pre><h4 id="u63D0_u4EA4_u66F4_u65B0"><a href="#u63D0_u4EA4_u66F4_u65B0" class="headerlink" title="提交更新"></a>提交更新</h4><pre><code>svn ci file 
</code></pre><h4 id="u5220_u9664_u6587_u4EF6"><a href="#u5220_u9664_u6587_u4EF6" class="headerlink" title="删除文件"></a>删除文件</h4><pre><code>svn delete file
</code></pre><h3 id="svn_hooks"><a href="#svn_hooks" class="headerlink" title="svn hooks"></a>svn hooks</h3><p>1 创建一个项目</p>
<pre><code>svnadmin create /data/svndata/testhook
</code></pre><p>2 创建项目钩子脚本</p>
<pre><code>$ cp /data/svndata/testhook/hooks/post-commit.tmpl /data/svndata/testhook/hooks/post-commit
$ chmod u+x /data/svndata/testhook/hooks/post-commit
</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat /data/svndata/testhook/hooks/post-commit</span><br><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line">PATH=/usr/bin/</span><br><span class="line">UPDATE_DIR=/opt/www/svnhook/testhook/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 触发钩子会传入2个参数: 一个是仓库名, 一个是版本号</span></span><br><span class="line">REPOS=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">REV=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取提交者和提交信息</span></span><br><span class="line">AUTHOR=$(<span class="variable">$PATH</span>/svnlook author -r <span class="variable">$REV</span> <span class="variable">$REPOS</span>)</span><br><span class="line">MESSAGE=$(<span class="variable">$PATH</span>/svnlook <span class="built_in">log</span> <span class="variable">$REPOS</span> -r <span class="variable">$REV</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新操作</span></span><br><span class="line"><span class="variable">$PATH</span>/svn update --username=svnhook --password=svnhook4rfv --no-auth-cache --non-interactive <span class="variable">$UPDATE_DIR</span> <span class="number">2</span>&gt;&gt; /tmp/svnhook_error.log</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? == <span class="number">0</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"`date +"</span>%F %R:%S<span class="string">"` author: <span class="variable">$AUTHOR</span>  update <span class="variable">$REPOS</span> version: <span class="variable">$REV</span> message: <span class="variable">$MESSAGE</span>"</span> &gt;&gt; /tmp/svnhook.log</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>3 为testhook仓库添加一个只读用户,用于更新目标仓库:</p>
<pre><code>$ cd /data/svndata/testhook/conf

$ grep -Ev &quot;(^$|^#)&quot; authz
[groups]
hook = svnhook


[/]
@hook = r

[svndata:/test]
@hook = r


$ grep -Ev &quot;(^$|^#)&quot; passwd
[users]
svnhook = svnhook


$ grep -Ev &quot;(^$|^#)&quot; svnserve.conf
[general]
anon-access = none
auth-access = write
password-db = passwd
authz-db = authz
[sasl]
</code></pre><p>4 重启 svn, 使配置生效</p>
<p>5 到 nginx 目录下先 checkout 项目</p>
<pre><code>$ cd /opt/www/svnhook/
$ svn co  svn://localhost/testhook
</code></pre><p>6 本地 checkout 仓库, 修改文件上传, 看是否触发钩子</p>
<h4 id="u9047_u5230_u7684_u5751"><a href="#u9047_u5230_u7684_u5751" class="headerlink" title="遇到的坑"></a>遇到的坑</h4><p>测试用的仓库是没问题了, 但是在文档仓库做这个配置之后, 发现不能实现更新, 一开始以为没触发钩子, 首先以为是<strong>权限问题</strong>, 把 <code>post-commit</code> 脚本改成了777, 把更新目录的用户也折腾了一下, 还是不行.</p>
<p>后来以为<strong>钩子没触发</strong>, 但是在钩子脚本中加入的测试日志表明, 是触发了钩子的</p>
<p>于是就去看<strong>错误日志</strong>, 发现有这样的报错:</p>
<pre><code>cat /tmp/svnhook_error.log
Updating &apos;opt/www/svnhook/document&apos;:
svn: E000022: Error converting entry in directory &apos;/opt/www/svnhook/testhook/php&apos; to UTF-8
svn: E000022: Can&apos;t convert string from native encoding to &apos;UTF-8&apos;:
svn: E000022: ?\230?\149?\176?\230?\141?\174?\230?\168?\161?\229?\158?\139
</code></pre><p>原来是字符集的问题, locale看了一下系统的, 是 en_US, 但是文件中有中文, 所以就执行不了 update 了</p>
<p>解决方法 → 在脚本中加入:</p>
<pre><code>export LC_ALL=zh_CN.UTF-8
</code></pre><p><strong>日志很重要!!</strong></p>
<p><strong>日志很重要!!</strong></p>
<p><strong>日志很重要!!</strong></p>
<h3 id="u5E38_u7528_u7BA1_u7406_u547D_u4EE4"><a href="#u5E38_u7528_u7BA1_u7406_u547D_u4EE4" class="headerlink" title="常用管理命令"></a>常用管理命令</h3><h4 id="u67E5_u770B_u6240_u6709_u4ED3_u5E93_u7248_u672C_u6570"><a href="#u67E5_u770B_u6240_u6709_u4ED3_u5E93_u7248_u672C_u6570" class="headerlink" title="查看所有仓库版本数"></a>查看所有仓库版本数</h4><pre><code>$ for i in `ls -l /data/svndata |awk &apos;/^d/{print $9}&apos;`;do echo $i;svnlook youngest $i ;done
config_app
24
document
7
app
2
Nevermore
2
inner_app
125
outer_app
8
</code></pre><h3 id="u5410_u69FD"><a href="#u5410_u69FD" class="headerlink" title="吐槽"></a>吐槽</h3><p>1 一个项目里的多个子项目居然是并列创建在根目录下面的… 正确的姿势不应该是创建在同一个项目目录比如 brunch下面么, 每次 checkout brunch 就能把项目内的子项目都下载了 - -</p>
<p>2 居然有人把一个800M 的软件上传 svn …… 如果还有人这么搞, 我得弄个<code>pre-commit</code>限制上传的文件大小了</p>
<p><a href="http://blog.csdn.net/yuanya/article/details/23271951" target="_blank" rel="external">linux下svn命令大全</a></p>
<p><a href="http://songxj.blog.51cto.com/620981/396113" target="_blank" rel="external">参考</a></p>
<p><a href="http://blog.csdn.net/pttaag/article/details/8076210" target="_blank" rel="external">SVN的标准目录结构：trunk、branches、tags</a></p>
<p><a href="http://spiritfrog.iteye.com/blog/448578" target="_blank" rel="external">svn备份和还原</a></p>
<p><a href="https://segmentfault.com/a/1190000000596975" target="_blank" rel="external">Ubuntu下svn的使用总结</a></p>
<p><a href="http://www.ha97.com/4467.html" target="_blank" rel="external">CentOS Linux搭建SVN Server配置详解</a></p>
<p><a href="http://cnbin.github.io/blog/2015/06/13/mac-da-jian-svn-fu-wu-qi-huan-jing/" target="_blank" rel="external">Mac 搭建 SVN 服务器环境</a></p>
<p><a href="http://yangzb.iteye.com/blog/315023" target="_blank" rel="external">svn备份策略</a></p>
<p><a href="http://1234n.com/?post/dd00ny" target="_blank" rel="external">支持完整＋差异＋压缩的Subversion备份脚本</a></p>
<p>hook</p>
<p><a href="http://blog.csdn.net/lgm252008/article/details/7026426" target="_blank" rel="external">Linux下SVN自动更新web</a></p>
<p><a href="http://www.cnblogs.com/gaohj/p/3154448.html" target="_blank" rel="external">SVN-钩子祥解与配置</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u521B_u5EFA_u4ED3_u5E93"><a href="#u521B_u5EFA_u4ED3_u5E93" class="headerlink" title="创建仓库"></a>创建仓库</h3><pre><code>svnadmin create /data/svndata/winne  # winne为版本库名称
</code></pre><h3 id="u6DFB_u52A0_u8D26_u6237"><a href="#u6DFB_u52A0_u8D26_u6237" class="headerlink" title="添加账户"></a>添加账户</h3><pre><code>cd /data/svndata/winne/conf
</code></pre><p>编辑 <code>authz</code> 文件, 用户权限</p>
<pre><code>[groups]
admin = bill,ada   
[/]
@admin = rw
[svndata:/document]
@admin     = rw
</code></pre><p>编辑 <code>passwd</code> 文件, 用户的密码</p>
<pre><code>[users]
ada = ada
bill = 123123123123
</code></pre><p>编辑<code>svnserve.conf</code> , 确保有以下配置</p>
<pre><code>[general]
auno-access = none
auth-access = write
password-db = passwd
authz-db = authz
</code></pre>]]>
    
    </summary>
    
      <category term="svn" scheme="http://yoursite.com/tags/svn/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[sed学习笔记]]></title>
    <link href="http://yoursite.com/2016/03/11/sed%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2016/03/11/sed学习笔记/</id>
    <published>2016-03-11T12:20:04.000Z</published>
    <updated>2016-04-07T12:25:43.000Z</updated>
    <content type="html"><![CDATA[<p>定位行 ‘/pattern/‘</p>
<p>定位行内匹配变量  ‘s///3’</p>
<p>操作:</p>
<p>修改行内 s</p>
<h3 id="u5173_u4E8E_u6B63_u5219_u8868_u8FBE_u5F0F"><a href="#u5173_u4E8E_u6B63_u5219_u8868_u8FBE_u5F0F" class="headerlink" title="关于正则表达式"></a>关于正则表达式</h3><p>流派:</p>
<pre><code>正则表达式
    |-- PCRE
    `-- POSIX
        |-- BRE
        |   |-- grep
        |   |-- sed
        |   `-- vi
        `-- ERE
            |-- awk
            `-- egrep
</code></pre><p>正则表达式基础:</p>
<pre><code>^ 表示一行的开头。如：/^#/ 以#开头的匹配。
$ 表示一行的结尾。如：/}$/ 以}结尾的匹配。
\&lt; 表示词首。 如 \&lt;abc 表示以 abc 为首的詞。
\&gt; 表示词尾。 如 abc\&gt; 表示以 abc 結尾的詞。
. 表示任何单个字符。
\* 表示某个字符出现了0次或多次。
[ ] 字符集合。 如：[abc]表示匹配a或b或c，还有[a-zA-Z]表示匹配所有的26个字符。如果其中有^表示反，如[^a]表示非a的字符
</code></pre><a id="more"></a>
<h3 id="Hold_Space__u7F13_u51B2_u533A"><a href="#Hold_Space__u7F13_u51B2_u533A" class="headerlink" title="Hold Space 缓冲区"></a>Hold Space 缓冲区</h3><p>Pattern Space 就是当前读入行</p>
<pre><code>g： 将hold space中的内容拷贝到pattern space中，原来pattern space里的内容清除
G： 将hold space中的内容append到pattern space\n后
h： 将pattern space中的内容拷贝到hold space中，原来的hold space里的内容被清除
H： 将pattern space中的内容append到hold space\n后
x： 交换pattern space和hold space的内容
</code></pre><p>g( go, 走你 ) 类似于 cat <code>hold space</code> &gt; <code>pattern space</code></p>
<p>G( 大狗, 追加 ) 类似于 cat <code>hold space</code> &gt;&gt; <code>pattern space</code></p>
<p>h( 跟g相反 ),  cat <code>pattern space</code> &gt; <code>hold space</code></p>
<p>H ( 跟G相反 ), 类似于 <code>pattern space</code> cat  &gt;&gt; <code>hold space</code></p>
<h3 id="u5B9E_u4F8B"><a href="#u5B9E_u4F8B" class="headerlink" title="实例"></a>实例</h3><p>1.匹配以500结尾的工资(BRE正则要转义)</p>
<pre><code>root@Ubuntu:~/awkpractice# sed -n &quot;/:[0-9]+500$/p&quot; datafile
root@Ubuntu:~/awkpractice# sed -n &quot;/:[0-9]\+500$/p&quot; datafile
Paco Gutierrez:835-365-1284:454 Easy Street, Decatur, IL 75732:2/28/53:123500
Barbara Kertz:385-573-8326:832 Ponce Drive, Gary, IN 83756:12/1/46:268500
William Kopf:846-836-2837:6937 Ware Road, Milton, PA 93756:9/21/46:43500
Sir Lancelot:837-835-8257:474 Camelot Boulevard, Bath, WY 28356:5/13/69:24500
Zippy Pinhead:834-823-8319:2356 Bizarro Ave., Farmount, IL 84357:1/1/67:89500
</code></pre><p>2.姓名交换位置–圆括号的使用</p>
<pre><code>root@Ubuntu:~/awkpractice# sed  &apos;s/\(^[a-zA-Z]\+\)\ \([a-zA-Z]\+\):\(.*\)/\2 \1:\3/&apos; datafile
Corder Norma:397-857-2735:74 Pine Street, Dearborn, MI 23874:3/28/45:245700
Cowan Jennifer:548-834-2348:583 Laurel Ave., Kingsville, TX 83745:10/1/35:58900
DeLoach Jon:408-253-3122:123 Park St., San Jose, CA 04086:7/25/53:85100
Evich Karen:284-758-2857:23 Edgecliff Place, Lincoln, NB 92086:7/25/53:85100
Evich Karen:284-758-2867:23 Edgecliff Place, Lincoln, NB 92743:11/3/35:58200
</code></pre><p>3.把 port 的数字填到 zoneid里去 (使用 ERE 模式的 sed)</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line">root@Ubuntu:~/awkpractice# cat gamefile</span><br><span class="line">&lt;server name=<span class="string">"92服"</span>  <span class="keyword">port</span>=<span class="string">"10092"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">""</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">&lt;server name=<span class="string">"93服"</span>  <span class="keyword">port</span>=<span class="string">"10093"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">""</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">&lt;server name=<span class="string">"94服"</span>  <span class="keyword">port</span>=<span class="string">"10094"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">""</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">&lt;server name=<span class="string">"95服"</span>  <span class="keyword">port</span>=<span class="string">"10095"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">""</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">&lt;server name=<span class="string">"96服"</span>  <span class="keyword">port</span>=<span class="string">"10096"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">""</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">root@Ubuntu:~/awkpractice# sed -r <span class="attribute">'s</span>/(.*<span class="keyword">port</span>=<span class="string">")([0-9]+)("</span>.*zoneid=<span class="string">")("</span>.*$)/\<span class="number">1</span>\<span class="number">2</span>\<span class="number">3</span>\<span class="number">2</span>\<span class="number">4</span>/' gamefile</span><br><span class="line">&lt;server name=<span class="string">"92服"</span>  <span class="keyword">port</span>=<span class="string">"10092"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">"10092"</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">&lt;server name=<span class="string">"93服"</span>  <span class="keyword">port</span>=<span class="string">"10093"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">"10093"</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">&lt;server name=<span class="string">"94服"</span>  <span class="keyword">port</span>=<span class="string">"10094"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">"10094"</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">&lt;server name=<span class="string">"95服"</span>  <span class="keyword">port</span>=<span class="string">"10095"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">"10095"</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br><span class="line">&lt;server name=<span class="string">"96服"</span>  <span class="keyword">port</span>=<span class="string">"10096"</span> os=<span class="string">"android"</span>  hidden=<span class="string">"false"</span> recommendrate=<span class="string">"0"</span> newport=<span class="string">""</span> zoneid=<span class="string">"10096"</span> tabname=<span class="string">"地区服"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>sed默认是BRE，加上-r参数后变成ERE</p>
<p>4.<a href="http://bbs.chinaunix.net/thread-4241283-1-1.html" target="_blank" rel="external">关于sed中的\1\2\3能否赋值给变量</a></p>
<p>感谢:</p>
<p><a href="http://coolshell.cn/articles/9104.html" target="_blank" rel="external">sed 简明教程</a></p>
<p><a href="http://www.infoq.com/cn/news/2011/07/regular-expressions-6-POSIX" target="_blank" rel="external">Linux/Unix工具与正则表达式的POSIX规范</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>定位行 ‘/pattern/‘</p>
<p>定位行内匹配变量  ‘s///3’</p>
<p>操作:</p>
<p>修改行内 s</p>
<h3 id="u5173_u4E8E_u6B63_u5219_u8868_u8FBE_u5F0F"><a href="#u5173_u4E8E_u6B63_u5219_u8868_u8FBE_u5F0F" class="headerlink" title="关于正则表达式"></a>关于正则表达式</h3><p>流派:</p>
<pre><code>正则表达式
    |-- PCRE
    `-- POSIX
        |-- BRE
        |   |-- grep
        |   |-- sed
        |   `-- vi
        `-- ERE
            |-- awk
            `-- egrep
</code></pre><p>正则表达式基础:</p>
<pre><code>^ 表示一行的开头。如：/^#/ 以#开头的匹配。
$ 表示一行的结尾。如：/}$/ 以}结尾的匹配。
\&lt; 表示词首。 如 \&lt;abc 表示以 abc 为首的詞。
\&gt; 表示词尾。 如 abc\&gt; 表示以 abc 結尾的詞。
. 表示任何单个字符。
\* 表示某个字符出现了0次或多次。
[ ] 字符集合。 如：[abc]表示匹配a或b或c，还有[a-zA-Z]表示匹配所有的26个字符。如果其中有^表示反，如[^a]表示非a的字符
</code></pre>]]>
    
    </summary>
    
      <category term="sed" scheme="http://yoursite.com/tags/sed/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[awk学习笔记(一)]]></title>
    <link href="http://yoursite.com/2016/03/08/awk%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%80/"/>
    <id>http://yoursite.com/2016/03/08/awk学习笔记-一/</id>
    <published>2016-03-08T01:18:04.000Z</published>
    <updated>2016-04-07T12:26:02.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u8BED_u6CD5"><a href="#u8BED_u6CD5" class="headerlink" title="语法"></a>语法</h3><p>awk ‘/PATTERN/{action}’  <a href="http://ama2000.iteye.com/blog/1304823" target="_blank" rel="external">详情参考</a></p>
<p>else if 这种不能放 pattern, 只能放 action</p>
<p>来点例子加深印象:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">awk -F, '&#123;<span class="keyword">print</span> <span class="string">""</span>;<span class="keyword">print</span> <span class="label">$2&#125;</span>' OFS=<span class="string">"\t"</span></span><br><span class="line">awk 'BEGIN&#123;FS=<span class="string">":"</span>&#125; &#123;<span class="keyword">if</span>(<span class="label">$6</span> ~ /TIME/ ) <span class="keyword">print</span> <span class="label">$1&#125;</span>'</span><br><span class="line">awk &#123;<span class="keyword">sum</span>+=<span class="label">$5&#125;</span> END &#123;<span class="keyword">print</span> <span class="keyword">sum</span>&#125;</span><br></pre></td></tr></table></figure>
<p>输入驱动</p>
<p>匹配行 /xx/</p>
<p>匹配字段 $6 ~ /xx/</p>
<a id="more"></a>
<h4 id="u5B66_u4E60_u8D44_u6599"><a href="#u5B66_u4E60_u8D44_u6599" class="headerlink" title="学习资料"></a>学习资料</h4><p>据说看完<a href="http://xstarcd.github.io/wiki/shell/awk_oneliner.html" target="_blank" rel="external">awk_oneliner</a>就成 awk 高手了, 看了80%, 自我感觉不错~, 大部分 awk 学习博客的例子已经可以自行解决了</p>
<h3 id="u7591_u95EE"><a href="#u7591_u95EE" class="headerlink" title="疑问"></a>疑问</h3><p>1.下面的为何+号位置不同, 导致 root 的内存占用也不同呢? 似乎 += 这种是正确的写法</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~/awkpractice</span><span class="comment"># ps aux |awk 'NR!=1&#123;a[$1]=+$6&#125; END &#123;for (i in a) print i, a[i]"KB"&#125;'</span></span><br><span class="line">privoxy <span class="number">3392</span>KB</span><br><span class="line">message+ <span class="number">2492</span>KB</span><br><span class="line">syslog <span class="number">3872</span>KB</span><br><span class="line">daemon <span class="number">164</span>KB</span><br><span class="line">root <span class="number">6228</span>KB</span><br><span class="line">root<span class="variable">@Ubuntu</span><span class="symbol">:~/awkpractice</span><span class="comment"># ps aux |awk 'NR!=1&#123;a[$1]+=$6&#125; END &#123;for (i in a) print i, a[i]"KB"&#125;'</span></span><br><span class="line">privoxy <span class="number">3392</span>KB</span><br><span class="line">message+ <span class="number">2492</span>KB</span><br><span class="line">syslog <span class="number">3872</span>KB</span><br><span class="line">daemon <span class="number">164</span>KB</span><br><span class="line">root <span class="number">94852</span>KB</span><br></pre></td></tr></table></figure>
<h3 id="u5B9E_u4F8B_3A"><a href="#u5B9E_u4F8B_3A" class="headerlink" title="实例:"></a>实例:</h3><p>1.去重复行, 原理就是利用初始数组变量值为零<a href="http://blog.csdn.net/crazyhacking/article/details/12521919" target="_blank" rel="external">去重原理分析</a></p>
<pre><code>awk &apos;!a[$0]++&apos; &lt;filename&gt;
</code></pre><p>2.显示所有只有四个字符的名</p>
<pre><code>awk  &apos;{if(length($1)==4)  print $1}&apos; datafile
</code></pre><p>3.文件合并</p>
<p>我有2个文件 tmp1.txt 和 tmp2.txt</p>
<pre><code>tmp1.txt
20
18
19

tmp2.txt
15
14
13
</code></pre><p>我想做个文件tmp3.txt做成</p>
<pre><code>20 15
18 14
19 13
</code></pre><p>方法一, 用 paste 命令</p>
<pre><code>paste tmp1.txt tmp2.txt &gt;tmp3.txt
</code></pre><p>方法二, 用 FNR 和 NR , 输出$0 (合并2个文件有用)</p>
<pre><code>awk &apos;NR==FNR{a[NR]=$0} NR&gt;FNR{print a[FNR],$0}&apos; tmp1.txt tmp2.txt | tee tmp3.txt
</code></pre><p>方法三, 使用数组存储$1</p>
<pre><code>awk &apos;NR==FNR{a[NR]=$1;count=NR} NR&gt;FNR{b[NR-count]=$1} END{for(i=1;i&lt;=count;i++)print a[i],b[i]}&apos; tmp1.txt tmp2.txt | tee tmp3.txt
</code></pre><p>4.把以\结束的行同下一行相接(sub, getline, next用法)</p>
<pre><code>awk &apos;/\\$/ { sub(/\\$/,&quot;&quot;); getline t; print $0 t; next }; 1′
</code></pre><p>首先查找以\结束的行，并删除\。然后getline函数获取下一行的内容，输出当前行（去掉了\）和下一行的相接后的内容。并用next跳过后面的1避免重复输出。如果当前行行末没有\，会直接执行1输出。</p>
<p>5.合并行输出(next在多行合并，以及选择性输出方面，非常方便)</p>
<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><span class="line"><span class="function_or_atom">root</span>@<span class="variable">Ubuntu</span>:~/<span class="function_or_atom">awkpractice</span># <span class="function_or_atom">cat</span> <span class="number">6</span>.<span class="function_or_atom">c</span></span><br><span class="line"><span class="function_or_atom">web01</span>[<span class="number">192.168</span>.<span class="number">2.100</span>]</span><br><span class="line"></span><br><span class="line"><span class="function_or_atom">httpd</span>            <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">tomcat</span>               <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">sendmail</span>               <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">web02</span>[<span class="number">192.168</span>.<span class="number">2.101</span>]</span><br><span class="line"><span class="function_or_atom">httpd</span>            <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">postfix</span>               <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">web03</span>[<span class="number">192.168</span>.<span class="number">2.102</span>]</span><br><span class="line"><span class="function_or_atom">mysqld</span>            <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">httpd</span>               <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">root</span>@<span class="variable">Ubuntu</span>:~/<span class="function_or_atom">awkpractice</span># <span class="function_or_atom">awk</span> <span class="string">'$1 ~ /web/ &#123;a=$0;next&#125; ; !/^$/ &#123;print a":\t" $0&#125;'</span> <span class="number">6</span>.<span class="function_or_atom">c</span></span><br><span class="line"><span class="function_or_atom">web01</span>[<span class="number">192.168</span>.<span class="number">2.100</span>]:	<span class="function_or_atom">httpd</span>            <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">web01</span>[<span class="number">192.168</span>.<span class="number">2.100</span>]:	<span class="function_or_atom">tomcat</span>               <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">web01</span>[<span class="number">192.168</span>.<span class="number">2.100</span>]:	<span class="function_or_atom">sendmail</span>               <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">web02</span>[<span class="number">192.168</span>.<span class="number">2.101</span>]:	<span class="function_or_atom">httpd</span>            <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">web02</span>[<span class="number">192.168</span>.<span class="number">2.101</span>]:	<span class="function_or_atom">postfix</span>               <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">web03</span>[<span class="number">192.168</span>.<span class="number">2.102</span>]:	<span class="function_or_atom">mysqld</span>            <span class="ok">ok</span></span><br><span class="line"><span class="function_or_atom">web03</span>[<span class="number">192.168</span>.<span class="number">2.102</span>]:	<span class="function_or_atom">httpd</span>               <span class="ok">ok</span></span><br></pre></td></tr></table></figure>
<p>6.把每5行用逗号相连</p>
<p>pattern ? pattern : pattern  (三目运算符) 满足表达式条件, 就输出?后面的, 不满足输出:后面的</p>
<pre><code>awk &apos;ORS=NR%5?&quot;,&quot;:&quot;\n&quot;&apos;
</code></pre><p>这里在每行输出前，对ORS重新进行定义，如果行号能被5整除则为\n，否则为逗号。（也很天书的一句）</p>
<p>7.getline 的一些用法</p>
<pre><code>#输出偶数行, 不跟变量赋值给$0
seq 10 |awk &apos;{getline;print}&apos;
#输出奇数行
seq 10 |awk &apos;{getline t;print}&apos;
#配合 system , 因为 system(cmd)返回的是 cmd 的返回值
awk &apos;BEGIN{ while( system(&quot;ls -l&quot;) | getline line ){ print line } }&apos;
</code></pre><p>8.split</p>
<p>The awk function split(s,a,sep) splits a string s into an awk array a using the delimiter sep.</p>
<pre><code>set time = 12:34:56
set hr = `echo $time | awk &apos;{split($0,a,&quot;:&quot; ); print a[1]}&apos;` # = 12
set sec = `echo $time | awk &apos;{split($0,a,&quot;:&quot; ); print a[3]}&apos;` # = 56
# = 12 34 56
set hms = `echo $time | awk &apos;{split($0,a,&quot;:&quot; ); print a[1], a[2], a[3]}&apos;`
</code></pre><p>Q:</p>
<pre><code>name=&quot;76868&amp;5676&amp;435&amp;43526&amp;334&amp;12312312&amp;12321&quot;
awk &apos;BEGIN {print split(&quot;$name&quot;, filearray, &quot;&amp;&quot;)}&apos;
</code></pre><p>为什么是1</p>
<p>而</p>
<pre><code>awk &apos;BEGIN {print split(&quot;76868&amp;5676&amp;435&amp;43526&amp;334&amp;12312312&amp;12321&quot;, filearray, &quot;&amp;&quot;)}&apos;
</code></pre><p>则返回正确的结果，应该是7，有没有人解答一下？</p>
<p>A:</p>
<p>变量引用错误，这样做试试</p>
<pre><code>awk &apos;BEGIN {print split(&apos;&quot;\&quot;$name\&quot;&quot;&apos;, filearray, &quot;&amp;&quot;)}&apos;
</code></pre><p>awk规定引用系统变量必须使用单引号加双引号，即’”$sysvar”‘这样的格式，但是split函数也需要双引号来定界，但这个双引号又不能让sh解释，而应留给awk来解释，所以使用了\”和\”组成的双引号</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u8BED_u6CD5"><a href="#u8BED_u6CD5" class="headerlink" title="语法"></a>语法</h3><p>awk ‘/PATTERN/{action}’  <a href="http://ama2000.iteye.com/blog/1304823">详情参考</a></p>
<p>else if 这种不能放 pattern, 只能放 action</p>
<p>来点例子加深印象:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">awk -F, '&#123;<span class="keyword">print</span> <span class="string">""</span>;<span class="keyword">print</span> <span class="label">$2&#125;</span>' OFS=<span class="string">"\t"</span></span><br><span class="line">awk 'BEGIN&#123;FS=<span class="string">":"</span>&#125; &#123;<span class="keyword">if</span>(<span class="label">$6</span> ~ /TIME/ ) <span class="keyword">print</span> <span class="label">$1&#125;</span>'</span><br><span class="line">awk &#123;<span class="keyword">sum</span>+=<span class="label">$5&#125;</span> END &#123;<span class="keyword">print</span> <span class="keyword">sum</span>&#125;</span><br></pre></td></tr></table></figure>
<p>输入驱动</p>
<p>匹配行 /xx/</p>
<p>匹配字段 $6 ~ /xx/</p>]]>
    
    </summary>
    
      <category term="awk" scheme="http://yoursite.com/tags/awk/"/>
    
      <category term="it" scheme="http://yoursite.com/categories/it/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[三月份的碎碎念]]></title>
    <link href="http://yoursite.com/2016/03/03/%E4%B8%89%E6%9C%88%E4%BB%BD%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    <id>http://yoursite.com/2016/03/03/三月份的碎碎念/</id>
    <published>2016-03-03T00:57:16.000Z</published>
    <updated>2016-04-07T01:44:33.000Z</updated>
    <content type="html"><![CDATA[<h3 id="2016_u5E743_u67081_u65E5"><a href="#2016_u5E743_u67081_u65E5" class="headerlink" title="2016年3月1日"></a>2016年3月1日</h3><h3 id="2016_u5E743_u67082_u65E5"><a href="#2016_u5E743_u67082_u65E5" class="headerlink" title="2016年3月2日"></a>2016年3月2日</h3><p>生活顺心的一个关键字: 早</p>
<h3 id="2016_u5E743_u67083_u65E5"><a href="#2016_u5E743_u67083_u65E5" class="headerlink" title="2016年3月3日"></a>2016年3月3日</h3><p>别把别人眼中的自己, 看的太重</p>
<h3 id="2016_u5E743_u67084_u65E5"><a href="#2016_u5E743_u67084_u65E5" class="headerlink" title="2016年3月4日"></a>2016年3月4日</h3><p>符号-指针-意义</p>
<p>BGM: 脱缰</p>
<p>曾经听不懂的歌, 看不明白的文字, 会在你经历了某些事之后, 明白其意义. <strong>一切的表现形式(文字,音乐等)都是”符号”. 经历则是”指针”. 符号只有经过指针, 才能指到你人生意义的梯田上</strong>. 所以, 读万卷书, 是获取符号, 行万里路则是寻找指针. 所以才会有: 纸上得来终觉浅, 绝知此事要躬行.</p>
<h3 id="2016_u5E743_u67085_u65E5"><a href="#2016_u5E743_u67085_u65E5" class="headerlink" title="2016年3月5日"></a>2016年3月5日</h3><p>不要做短半衰期的事情, 要做能叠加效益的事情</p>
<p>凭什么我要被挑选, 我要去当可以挑选的人, 无论是挑人, 还是挑物, 挑知识.</p>
<p>有心栽花花不成, 无心插柳柳成荫</p>
<p>感情的脆弱性–童话中两个贪心的人挖地下的财宝，结果挖出一个人的骸骨，虽然迅速埋上了，甚至在上面种了树，栽了花，但两个人心里都知道底下埋的是什么。看见树，看见花，想的却是地下的那具骸骨。</p>
<h3 id="2016_u5E743_u67086_u65E5"><a href="#2016_u5E743_u67086_u65E5" class="headerlink" title="2016年3月6日"></a>2016年3月6日</h3><p>许多人说要对生命里那些对自己造成伤害的人心存感激，因为他们对我们的成长有帮助，他们是我们的贵人。可是我要说那家伙就是贱人，就是一个贱人.                 –by 九把刀</p>
<h3 id="2016_u5E743_u67087_u65E5"><a href="#2016_u5E743_u67087_u65E5" class="headerlink" title="2016年3月7日"></a>2016年3月7日</h3><p>如果你无法承担失去一件事物, 那么最好不要拥有它.</p>
<p>当你在睡觉玩乐时, 想想别人都在如何的奋斗</p>
<p>人生就是无数个决定组成的, 睡前可以回忆一下这些决定带给自己的影响.</p>
<p>彼以国士待我，我以国士报之；彼以众人待我，我以众人报之.  </p>
<p>周末安利一部韩剧&lt;&lt;未生&gt;&gt;. 这部剧…真是一改我对韩剧的印象. &lt;&lt;&gt;&gt;</p>
<h3 id="2016_u5E743_u67088_u65E5"><a href="#2016_u5E743_u67088_u65E5" class="headerlink" title="2016年3月8日"></a>2016年3月8日</h3><p>恒大面试, 羊入狼群, 得变得像蛇一样聪敏, 像鸽子一样纯洁.  - -</p>
<h3 id="2016_u5E743_u67089_u65E5"><a href="#2016_u5E743_u67089_u65E5" class="headerlink" title="2016年3月9日"></a>2016年3月9日</h3><p>工作交接的最基本原则是让他们不要再找我们了</p>
<h3 id="2016_u5E743_u670810_u65E5"><a href="#2016_u5E743_u670810_u65E5" class="headerlink" title="2016年3月10日"></a>2016年3月10日</h3><p>不做计划的日子容易虚度…</p>
<h3 id="2016_u5E743_u670811_u65E5"><a href="#2016_u5E743_u670811_u65E5" class="headerlink" title="2016年3月11日"></a>2016年3月11日</h3><p>hd hr 今天迟迟不来电话, 最后我沉不住气打了过去, 告诉他我考虑好了, 下周可以去报到. ( 相当选择权又还回去了…)</p>
<p>结果 hr 说什么他们人力部门又新招了人什么的, 说晚点答复我. 我怎么感觉有点悬呢. </p>
<p>本来还不太高兴去的, 因为工作内容还有公司制度不是很喜欢. 后来看待遇确实不错, 就说服了自己去. </p>
<p>期间各种 YY …… 结果今天弄这一茬, 心里很不爽. 也许这就是患得患失吧. 主要之前说考虑, 是觉得自<br>己应该还有更好的机会, 结果简历连续被拒了… 对自己也有点没把握了感觉… 就更想去 hd 了我艹. </p>
<p>归根结底, 还是能力问题. 要是有运维开发的能力, 我才不会选择 hd 呢, 哼╭(╯^╰)╮. </p>
<p>哎, 结果, 就黄了. <strong>人, 需要有个基准, 不可太贪.</strong></p>
<p>还有, 在事情最终确定前, 还是不要去宣传了, 你忘了她生日那天的事了么, 千万沉住气, 沉住气才有持久的胜利!</p>
<p>今年开头有点不顺呢, 工作感情双双受挫.</p>
<h3 id="2016_u5E743_u670812_u65E5"><a href="#2016_u5E743_u670812_u65E5" class="headerlink" title="2016年3月12日"></a>2016年3月12日</h3><p>植树节–种一棵树最好的时间是十年前, 其次是现在.</p>
<p>貌似学会了早睡的方法–躺床上闭眼睛回忆一些事情</p>
<p>既然没被束缚, 那就学习一些自由的技能: 首推英语, 然后是投资, 编程终究还是用来提升效率的多.</p>
<h3 id="2016_u5E743_u670813_u65E5"><a href="#2016_u5E743_u670813_u65E5" class="headerlink" title="2016年3月13日"></a>2016年3月13日</h3><p>学了一天 awk 吧…, 早上起来晚了, 不过中午不用睡午觉了倒是不错.</p>
<h3 id="2016_u5E743_u670814_u65E5"><a href="#2016_u5E743_u670814_u65E5" class="headerlink" title="2016年3月14日"></a>2016年3月14日</h3><p>白色情人节, 无言</p>
<p>时光不仅能抚平伤痛, 还能淡化以往的快乐, 抹去你的音容. 也许, 我的记忆力真是越来越差了, 可能只是不想回忆吧…</p>
<h3 id="2016_u5E743_u670815_u65E5"><a href="#2016_u5E743_u670815_u65E5" class="headerlink" title="2016年3月15日"></a>2016年3月15日</h3><p>叫醒你的不是闹钟, 也不是梦想, 而是早睡, 其次是饿了…</p>
<h3 id="2016_u5E743_u670816_u65E5"><a href="#2016_u5E743_u670816_u65E5" class="headerlink" title="2016年3月16日"></a>2016年3月16日</h3><p>不够自私也会成为被拒绝的理由</p>
<p>每个子女都是父母的骄傲, 也请做子女的对得起这个称号.</p>
<p>是啊, 毫无根据的希望和安慰又有什么用呢</p>
<p>2016年3月21日</p>
<p>记住, 你选择这家公司的理由: </p>
<p>1.提升薪资水平</p>
<p>2.培养良好的工作生活习惯</p>
<p>3.适应大公司的制度</p>
<p>4.磨练意志, 锻炼好心态</p>
<h3 id="2016_u5E743_u670824_u65E5"><a href="#2016_u5E743_u670824_u65E5" class="headerlink" title="2016年3月24日"></a>2016年3月24日</h3><p><a href="https://sg.godaddy.com/zh/help/moving-a-domain-name-out-of-your-account-822" target="_blank" rel="external">godaddy 域名转出到阿里云</a></p>
<h3 id="2016_u5E743_u670825_u65E5"><a href="#2016_u5E743_u670825_u65E5" class="headerlink" title="2016年3月25日"></a>2016年3月25日</h3><p>忙成狗, 想到钱, 还是忍了</p>
<h3 id="2016_u5E743_u670826_u65E5"><a href="#2016_u5E743_u670826_u65E5" class="headerlink" title="2016年3月26日"></a>2016年3月26日</h3><p><a href="http://blog.csdn.net/cankingapp/article/details/18312117" target="_blank" rel="external">git 取消修改，恢复版本 命令大全</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="2016_u5E743_u67081_u65E5"><a href="#2016_u5E743_u67081_u65E5" class="headerlink" title="2016年3月1日"></a>2016年3月1日</h3><h3 id="2016_u5]]>
    </summary>
    
      <category term="碎碎念" scheme="http://yoursite.com/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
      <category term="life" scheme="http://yoursite.com/categories/life/"/>
    
  </entry>
  
</feed>
